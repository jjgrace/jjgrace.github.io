<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Rocketmq集群ymal部署</title>
      <link href="/posts/251575927.html"/>
      <url>/posts/251575927.html</url>
      
        <content type="html"><![CDATA[<h1 id="1-Rocketmq集群部署"><a href="#1-Rocketmq集群部署" class="headerlink" title="1. Rocketmq集群部署"></a>1. Rocketmq集群部署</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RocketMQ 5.0 提出了自主切换架构。自主切换架构新增了一个 Controller 模块，负责选主。当某个 Broker Master 故障，会选择合适的 Broker Slave 提升为 Master，无需人工介入</span><br></pre></td></tr></table></figure><h3 id="1-1-CRDS部署"><a href="#1-1-CRDS部署" class="headerlink" title="1.1 CRDS部署"></a>1.1 CRDS部署</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cd</span> /rocketmq/operator</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubectl apply -f  crds/.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubectl get crd</span></span><br></pre></td></tr></table></figure><h3 id="1-2-RocketMQ-Operator-部署"><a href="#1-2-RocketMQ-Operator-部署" class="headerlink" title="1.2 RocketMQ Operator 部署"></a>1.2 RocketMQ Operator 部署</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/rocketmq/operator</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubectl apply -f .</span></span><br></pre></td></tr></table></figure><h3 id="1-3-配置-Name-Service-CR–不执行"><a href="#1-3-配置-Name-Service-CR–不执行" class="headerlink" title="1.3 配置 Name Service CR–不执行"></a>1.3 配置 Name Service CR–不执行</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">配置 Name Service CR。Name Service CR 配置较为重要的字段有两个，其一为 size，即需要部署了多少个 NameServer 节点，其二为 hostNetwork ，默认 false ，此时客户端只能在 Kubernetes 集群内与 NameServer 进行通讯。如果Kubernetes 集群外的客户端需要访问到 RocketMQ 集群，需要将 hostNetwork 配为 true ，NameServer 的接入点需要配置为 NameServer 所在的 Node IP</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cd</span> /rocketmq</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubectl apply -f nameservices/rocketmq_nameservice_cr.yaml</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubectl get NameService -n jwgod-test</span></span><br></pre></td></tr></table></figure><h3 id="1-4-配置-Controller-CR–不执行"><a href="#1-4-配置-Controller-CR–不执行" class="headerlink" title="1.4 配置 Controller CR–不执行"></a>1.4 配置 Controller CR–不执行</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">配置 Controller CR。注意 size 需要配置为奇数。Controller 的数据需要持久化存储，可以利用云服务提供商提供的 StorageClass，无需自行维护存储。如果希望配置自己的存储</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cd</span> /rocketmq</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubectl apply -f controller/rocketmq_controller_cr.yaml</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubectl get Controller -n jwgod-test</span></span><br></pre></td></tr></table></figure><h3 id="1-5-配置-Broker-CR–不执行"><a href="#1-5-配置-Broker-CR–不执行" class="headerlink" title="1.5 配置 Broker CR–不执行"></a>1.5 配置 Broker CR–不执行</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">配置 Broker CR。示例中配置了两组 Broker，每组有一个备节点，同时将 clusterMode 设置为 Controller，启动自主切换架构集群</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cd</span> /rocketmq</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubectl apply -f  broker/rocketmq_broker_cr.yaml</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubectl get Broker -n jwgod-test</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">准备好以上三个模块的相关配置文件之后，执行 kubectl apply 命令提交给 Kubernetes 集群。其余的部署、运维等动作均交由 RocketMQ Operator 自动完成。</span><br><span class="line">成功部署后，可以通过 kubectl get po 命令查看部署的Pod。可以看到部署了4个Broker节点、Controller 和 NameSever 节点各3个。</span><br><span class="line">进入一个 Broker Pod，可以使用 clusterlist 命令查看集群状态，可以看到集群有两组 Broker，每一组各有一主（BID=0）一备</span><br></pre></td></tr></table></figure><h3 id="1-6-配置NS-Controller-Broker"><a href="#1-6-配置NS-Controller-Broker" class="headerlink" title="1.6 配置NS Controller Broker"></a>1.6 配置NS Controller Broker</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cd</span> /rocketmq</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubectl apply -f  cluster_rocketmq/rocketmq_v1alpha1_rocketmq_cluster.yaml</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubectl get NameService -n jwgod-test</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubectl get Controller -n jwgod-test</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubectl get Broker -n jwgod-test</span></span><br></pre></td></tr></table></figure><h3 id="1-7-rocketmq-dashboard"><a href="#1-7-rocketmq-dashboard" class="headerlink" title="1.7 rocketmq-dashboard"></a>1.7 rocketmq-dashboard</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cd</span> /rocketmq</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubectl apply -f  mqdashboard/rocketmq-dashboard.yaml</span></span><br></pre></td></tr></table></figure><h1 id="2-yaml文件下载地址"><a href="#2-yaml文件下载地址" class="headerlink" title="2. yaml文件下载地址"></a>2. yaml文件下载地址</h1><p><a href="https://download.csdn.net/download/qq_20339579/88800143">Rockermq yaml 部署文件下载</a></p>]]></content>
      
      
      <categories>
          
          <category> 容器 </category>
          
          <category> Rocketmq </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rocketmq </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redis集群部署</title>
      <link href="/posts/2223903158.html"/>
      <url>/posts/2223903158.html</url>
      
        <content type="html"><![CDATA[<h1 id="1-Redis集群部署-5-0-14"><a href="#1-Redis集群部署-5-0-14" class="headerlink" title="1. Redis集群部署 (5.0.14)"></a>1. Redis集群部署 (5.0.14)</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Redis 集群的优势:</span><br><span class="line">自动分割数据到不同的节点上.</span><br><span class="line">整个集群的部分节点失败或者不可达的情况下能够继续处理命令.</span><br><span class="line">Redis 集群的数据分片</span><br><span class="line">Redis 集群没有使用一致性hash, 而是引入了哈希槽的概念.</span><br><span class="line">Redis 集群有16384个哈希槽,每个key通过CRC16校验后对16384取模来决定放置哪个槽.</span><br><span class="line">集群的每个节点负责一部分hash槽,举个例子,比如当前集群有3个节点,那么:</span><br><span class="line">节点 A 包含 0 到 5500号哈希槽.</span><br><span class="line">节点 B 包含5501 到 11000 号哈希槽.</span><br><span class="line">节点 C 包含11001 到 16384号哈希槽.</span><br><span class="line">这种结构很容易添加或者删除节点. 比如如果我想新添加个节点D, 我需要从节点 A, B, C中得部分槽到D上.</span><br><span class="line">如果我想移除节点A,需要将A中得槽移到B和C节点上,然后将没有任何槽的A节点从集群中移除即可.</span><br><span class="line">由于从一个节点将哈希槽移动到另一个节点并不会停止服务,所以无论添加删除或者改变某个节点</span><br><span class="line">的哈希槽的数量都不会造成集群不可用的状态.</span><br></pre></td></tr></table></figure><h3 id="1-1-开启防火墙"><a href="#1-1-开启防火墙" class="headerlink" title="1.1 开启防火墙"></a>1.1 开启防火墙</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 开启防火墙</span></span></span><br><span class="line">systemctl status firewalld</span><br><span class="line">systemctl start firewalld</span><br><span class="line">firewall-cmd --reload</span><br><span class="line">firewall-cmd --list-all</span><br><span class="line">firewall-cmd --state</span><br><span class="line"></span><br><span class="line">firewall-cmd --zone=public --add-port=7000/tcp --permanent</span><br><span class="line">firewall-cmd --zone=public --add-port=7001/tcp --permanent</span><br><span class="line">firewall-cmd --zone=public --add-port=17000/tcp --permanent</span><br><span class="line">firewall-cmd --zone=public --add-port=17001/tcp --permanent</span><br></pre></td></tr></table></figure><h3 id="1-2-安装redis"><a href="#1-2-安装redis" class="headerlink" title="1.2 安装redis"></a>1.2 安装redis</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">- 安装路径：/usr/local/redis5-cluster</span><br><span class="line">- 配置文件：/usr/local/redis5-cluster/conf</span><br><span class="line"></span><br><span class="line">- 创建数据目录。</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">mkdir</span> -pv /usr/local/redis5-cluster/redis-data</span></span><br><span class="line">- 创建日志目录。</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">mkdir</span> -pv /usr/local/redis5-cluster/redis-logs</span></span><br><span class="line">- 创建配置目录。</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">mkdir</span> -pv /usr/local/redis5-cluster/conf</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">解压</span></span><br><span class="line">tar xzf redis-5.0.8.tar.gz</span><br><span class="line">make MALLOC=libc</span><br><span class="line">make install PREFIX=/usr/local/redis5</span><br><span class="line"></span><br><span class="line">cd /usr/local/redis5</span><br><span class="line">mkdir /usr/local/redis5/&#123;bin,logs,conf,redis_data&#125;</span><br><span class="line">cp redis-check-aof redis-benchmark redis-check-rdb redis-cli redis-sentinel redis-server redis-trib.rb /usr/local/redis5/bin/</span><br><span class="line">cp /home/software/redis-5.0.14/redis.conf  /usr/local/redis5/conf/</span><br></pre></td></tr></table></figure><h3 id="1-3-配置文件"><a href="#1-3-配置文件" class="headerlink" title="1.3 配置文件"></a>1.3 配置文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">需要修改的redis的配置文件,配置文件示例</span></span><br><span class="line">---其内容为：</span><br><span class="line">bind 192.168.1.30</span><br><span class="line">requirepass 123456</span><br><span class="line">protected-mode no</span><br><span class="line">port 7000 #需要修改端口。</span><br><span class="line">tcp-backlog 511</span><br><span class="line">timeout 0</span><br><span class="line">tcp-keepalive 300</span><br><span class="line">daemonize yes</span><br><span class="line">supervised no</span><br><span class="line">pidfile /usr/local/redis5-cluster/bin/redis_7000.pid #需要修改端口</span><br><span class="line">loglevel notice </span><br><span class="line">logfile /usr/local/redis5-cluster/redis-logs/redis-7000.log #需要修改端口</span><br><span class="line">databases 26</span><br><span class="line">always-show-logo yes</span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br><span class="line">stop-writes-on-bgsave-error yes</span><br><span class="line">rdbcompression yes</span><br><span class="line">rdbchecksum yes</span><br><span class="line">dbfilename dump-7000.rdb #需要修改端口</span><br><span class="line">dir /usr/local/redis5-cluster/redis_data/</span><br><span class="line">replica-serve-stale-data yes</span><br><span class="line">replica-read-only yes</span><br><span class="line">repl-diskless-sync no</span><br><span class="line">repl-diskless-sync-delay 5</span><br><span class="line">repl-disable-tcp-nodelay no</span><br><span class="line">replica-priority 100</span><br><span class="line">lazyfree-lazy-eviction no</span><br><span class="line">lazyfree-lazy-expire no</span><br><span class="line">lazyfree-lazy-server-del no</span><br><span class="line">replica-lazy-flush no</span><br><span class="line">appendonly yes</span><br><span class="line">appendfilename &quot;appendonly-7000.aof&quot; #需要修改端口</span><br><span class="line">appendfsync everysec</span><br><span class="line">no-appendfsync-on-rewrite no</span><br><span class="line">auto-aof-rewrite-percentage 100</span><br><span class="line">auto-aof-rewrite-min-size 64mb</span><br><span class="line">aof-load-truncated yes</span><br><span class="line">aof-use-rdb-preamble yes</span><br><span class="line">lua-time-limit 5000</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file redis-7000.conf #需要修改端口</span><br><span class="line">slowlog-log-slower-than 10000</span><br><span class="line">slowlog-max-len 128</span><br><span class="line">latency-monitor-threshold 0</span><br><span class="line">notify-keyspace-events &quot;&quot;</span><br><span class="line">hash-max-ziplist-entries 512</span><br><span class="line">hash-max-ziplist-value 64</span><br><span class="line">list-max-ziplist-size -2</span><br><span class="line">list-compress-depth 0</span><br><span class="line">set-max-intset-entries 512</span><br><span class="line">zset-max-ziplist-entries 128</span><br><span class="line">zset-max-ziplist-value 64</span><br><span class="line">hll-sparse-max-bytes 3000</span><br><span class="line">stream-node-max-bytes 4096</span><br><span class="line">stream-node-max-entries 100</span><br><span class="line">activerehashing yes</span><br><span class="line">client-output-buffer-limit normal 0 0 0</span><br><span class="line">client-output-buffer-limit replica 256mb 64mb 60</span><br><span class="line">client-output-buffer-limit pubsub 32mb 8mb 60</span><br><span class="line">hz 10</span><br><span class="line">dynamic-hz yes</span><br><span class="line">aof-rewrite-incremental-fsync yes</span><br><span class="line">rdb-save-incremental-fsync yes</span><br></pre></td></tr></table></figure><h3 id="1-4-部署过程"><a href="#1-4-部署过程" class="headerlink" title="1.4 部署过程"></a>1.4 部署过程</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">部署包</span></span><br><span class="line">/usr/local/redis5-cluster/redis-7000</span><br><span class="line">/usr/local/redis5-cluster/redis-7001</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动redis服务</span></span><br><span class="line">/usr/local/redis5-cluster/redis-7000/bin/redis-server /usr/local/redis5-cluster/redis-7000/conf/redis-7000.conf</span><br><span class="line">/usr/local/redis5-cluster/redis-7001/bin/redis-server /usr/local/redis5-cluster/redis-7001/conf/redis-7001.conf</span><br><span class="line"></span><br><span class="line">ps -ef |grep redis |grep redis5 |grep 7001 |awk &#x27;&#123;print $2&#125;&#x27;|xargs kill -9</span><br></pre></td></tr></table></figure><h3 id="1-5-创建集群"><a href="#1-5-创建集群" class="headerlink" title="1.5 创建集群"></a>1.5 创建集群</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">参数解释</span></span><br><span class="line">--replicas 1 表示我们希望为集群中的每个主节点创建一个从节点</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建集群</span></span><br><span class="line">echo yes| /usr/local/redis5-cluster/redis-7000/bin/redis-cli -h 192.168.1.30 -a 123456 -p 7000  --cluster create 192.168.1.30:7000 192.168.1.30:7001 192.168.1.31:7000 192.168.1.31:7001 192.168.1.32:7000 192.168.1.32:7001 --cluster-replicas 1 --cluster-yes</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">集群验证</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/usr/local/redis5-cluster/redis-7000/bin/redis-cli -h 192.168.1.30  -p 7000</span></span><br><span class="line">192.168.1.30:7000&gt; auth 123456</span><br><span class="line">OK</span><br><span class="line">192.168.1.30:7000&gt; cluster nodes</span><br><span class="line">85eaca64000d30f45a67536c53d2dc66adfab08b 192.168.1.32:7000@17000 master - 0 1688714888000 5 connected 10923-16383</span><br><span class="line">7da8c524474d3ea7db335000c694c812afebd57c 192.168.1.32:7001@17001 slave 7bd394bfe5d692c5e8df93ed6721b8020fd17e5e 0 1688714889289 6 connected</span><br><span class="line">63d1e6e9eaa1cf89d08db90e75af6172743e15ff 192.168.1.31:7001@17001 slave 193a4ffd4e5bb2f541e925db3119f9c81b8fb21c 0 1688714888000 4 connected</span><br><span class="line">193a4ffd4e5bb2f541e925db3119f9c81b8fb21c 192.168.1.30:7000@17000 myself,master - 0 1688714888000 1 connected 0-5460</span><br><span class="line">7bd394bfe5d692c5e8df93ed6721b8020fd17e5e 192.168.1.31:7000@17000 master - 0 1688714890000 3 connected 5461-10922</span><br><span class="line">ce22d2cc1dbbe1874804fcfeb74bf14233276223 192.168.1.30:7001@17001 slave 85eaca64000d30f45a67536c53d2dc66adfab08b 0 1688714890292 5 connected</span><br></pre></td></tr></table></figure><h1 id="2-运维管理命令"><a href="#2-运维管理命令" class="headerlink" title="2. 运维管理命令"></a>2. 运维管理命令</h1><h4 id="2-1-命令"><a href="#2-1-命令" class="headerlink" title="2.1  命令"></a>2.1  命令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">- 安全关闭</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/usr/local/redis5-cluster/redis-7000/bin/redis-cli shutdown save</span></span><br><span class="line"></span><br><span class="line">- 不备份关闭</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/usr/local/redis5-cluster/redis-7000/bin/redis-cli shutdown nosave</span></span><br><span class="line"></span><br><span class="line">- 后台运⾏备份不阻塞主进程/save异步保存到硬盘 堵塞主进程</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">127.0.0.1:6379[1]&gt; bgsave</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Background saving started</span></span><br><span class="line"></span><br><span class="line">- aof备份⽅式-异步执⾏⼀个aof⽂件重写操作</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">127.0.0.1:6379[1]&gt; BGREWRITEAOF</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Background append only file rewriting started</span></span><br><span class="line"></span><br><span class="line">- 查看客户端连接情况</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">127.0.0.1:6379&gt; client list</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">age: 客户端存活的秒数</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">idle: 客户端空闲的秒数</span></span><br><span class="line"></span><br><span class="line">- kill掉⽐较损耗资源的连接</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">redis 10.10.1.173:6379&gt; client <span class="built_in">kill</span> 10.10.0.46:31574</span></span><br><span class="line"></span><br><span class="line">- 设置客户端标识-标记当前链接名</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">127.0.0.1:6379&gt; client setname jesse</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">127.0.0.1:6379&gt; client list</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">id</span>=127236 addr=127.0.0.1:39330 fd=6 name=jesse .....</span></span><br><span class="line"></span><br><span class="line">- 清空当前的数据库flushdb/flushall清空所有的数据库</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">127.0.0.1:6379[2]&gt; flushdb</span></span><br><span class="line"></span><br><span class="line">- 查看当前的roles</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">127.0.0.1:6379[2]&gt; ROLE</span></span><br><span class="line"> 1) &quot;master&quot;</span><br><span class="line"> 2) (integer) 0</span><br><span class="line"> 3) (empty list or set)</span><br><span class="line"> </span><br><span class="line">- 查看配置信息</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">127.0.0.1:6379[2]&gt; config get <span class="built_in">timeout</span></span></span><br><span class="line"> 1) &quot;timeout&quot;</span><br><span class="line"> 2) &quot;300&quot;</span><br><span class="line"> 127.0.0.1:6379[2]&gt; config get dbfilename</span><br><span class="line"> 1) &quot;dbfilename&quot;</span><br><span class="line"> 2) &quot;6379.rdb&quot;</span><br><span class="line"> </span><br><span class="line">- 在线修改参数</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">127.0.0.1:6379[2]&gt; config <span class="built_in">set</span> <span class="built_in">timeout</span> 301</span></span><br></pre></td></tr></table></figure><h4 id="2-2-持久化运维"><a href="#2-2-持久化运维" class="headerlink" title="2.2  持久化运维"></a>2.2  持久化运维</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">rdb/aof</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1.配置⽂件修改</span></span><br><span class="line"> save 900 1</span><br><span class="line"> save 300 10</span><br><span class="line"> save 60 10000</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2.命令⾏执⾏保存</span></span><br><span class="line"> save 前台执⾏ 堵塞主线程其它读写操作</span><br><span class="line"> bgsave 后台执⾏ 不堵塞读写操作</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3.⽇志⽂件追加持久化</span></span><br><span class="line"> appendonly yes</span><br><span class="line"> appendfilename &quot;appendonly.aof&quot;</span><br><span class="line"> appendfsync everysec</span><br><span class="line"> 执⾏命令：</span><br><span class="line"> bgrewriteaof</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">优点：每秒刷新⼀次磁盘 最多丢失1s数据</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">缺点：相同的数据集来说 AOF⽂件的体积通常要⼤于RDB⽂件的体积</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
          <category> Redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>红烧酱猪蹄</title>
      <link href="/posts/2127896466.html"/>
      <url>/posts/2127896466.html</url>
      
        <content type="html"><![CDATA[<div style="position: relative; padding-bottom: 56.25%; height: 0;">  <video src="https://jwgod-blog.oss-cn-beijing.aliyuncs.com/video/%E7%BE%8E%E9%A3%9F%E8%A7%86%E9%A2%91/%E7%BA%A2%E7%83%A7%E9%85%B1%E8%82%98%E5%AD%90_jwgod_x264.mp4" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;" controls>    Your browser does not support the video tag.  </video></div>]]></content>
      
      
      <categories>
          
          <category> 视频 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Videos </tag>
            
            <tag> Movie </tag>
            
            <tag> Food </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginx访问日志统计一周内的访问次数</title>
      <link href="/posts/3714048070.html"/>
      <url>/posts/3714048070.html</url>
      
        <content type="html"><![CDATA[<h2 id="nginx-access-wc"><a href="#nginx-access-wc" class="headerlink" title="nginx_access_wc"></a>nginx_access_wc</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">获取当前日期</span></span><br><span class="line">beg_time=$(date -d &quot;-7 day&quot; +%d/%b/%Y)</span><br><span class="line">end_time=$(date +%d/%b/%Y)</span><br><span class="line">sum_cont=0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">文件路径</span></span><br><span class="line">FILE=&quot;/home/script/nginx_access_wc.log&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">读取文件的最后一行</span></span><br><span class="line">last_line=$(tail -n 1 &quot;$FILE&quot;)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">提取最后一行中的数字</span></span><br><span class="line">number=$(echo &quot;$last_line&quot; |awk &#x27;&#123;print $2&#125;&#x27; | grep -oE &#x27;[0-9]+&#x27;)</span><br><span class="line"></span><br><span class="line">echo &quot;-----------------------------------------&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">用户数据</span></span><br><span class="line">user_count=`/usr/bin/mysql -h 192.168.1.xx -uxxxx -pxxxx@xxxx! -e &quot;select * from store.usertbl;&quot; |wc -l`</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">本周新增用户</span></span><br><span class="line">start_time=$(date -d &quot;-7 day&quot; +&quot;%Y-%m-%d 00:00:00&quot;)</span><br><span class="line">stop_time=$(date -d &quot;-1 day&quot; +&quot;%Y-%m-%d 23:59:59&quot;)</span><br><span class="line">add_user_count=$(/usr/bin/mysqlbinlog --start-datetime=&quot;$&#123;start_time&#125;&quot; --stop-datetime=&quot;$&#123;stop_time&#125;&quot; /var/lib/mysql/binlog.000001 -vv | grep -w &quot;### INSERT INTO&quot; | wc -l)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">新增用户的日期</span></span><br><span class="line">add_user_time=$(/usr/bin/mysqlbinlog --start-datetime=&quot;$&#123;start_time&#125;&quot; --stop-datetime=&quot;$&#123;stop_time&#125;&quot; /var/lib/mysql/binlog.000001 -vv |grep -w &quot;Write_rows&quot; |awk &#x27;&#123;print $1&#125;&#x27; |sed &#x27;s/#/20/g&#x27;)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">循环输出一周内的日期</span></span><br><span class="line">for ((i=7; i&gt;0; i--))</span><br><span class="line">do</span><br><span class="line">  current_date=$(date -d &quot;-$i day&quot; +%d/%b/%Y)</span><br><span class="line">  day_count=$(grep -E &quot;GET / HTTP/1.1&quot; /usr/local/nginx-1.20.2/logs/access.log |grep $current_date |awk -F &quot;:&quot; &#x27;&#123;print $2&quot;:&quot;$3&quot;:&quot;$4&#125;&#x27;|awk &#x27;$1&gt;=&quot;00:00:00&quot; &amp;&amp; $1&lt;=&quot;23:59:59&quot;&#x27; |wc -l)</span><br><span class="line">  sum_cont=$(($sum_cont + $day_count))         </span><br><span class="line">done</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">总浏览量</span></span><br><span class="line">ALL_COUNT=$(($&#123;number&#125; + $&#123;sum_cont&#125;))</span><br><span class="line"></span><br><span class="line">printf &quot;本次统计开始时间: $(date -d &quot;-7 day&quot; +%Y-%m-%d) 00:00:00\n&quot;</span><br><span class="line">printf &quot;本次统计结束时间: $(date -d &quot;-1 day&quot; +%Y-%m-%d) 23:59:59\n&quot;</span><br><span class="line">printf &quot;本周新增用户信息数: $&#123;add_user_count&#125;\n&quot;</span><br><span class="line">printf &quot;本周新增用户日期: $&#123;add_user_time&#125;\n&quot;</span><br><span class="line">printf &quot;用户信息收集总数据: $(($&#123;user_count&#125;-3))\n&quot;</span><br><span class="line">printf &quot;当周浏览量（上周日[00:00:00]到本周六[23:59:59]): $&#123;sum_cont&#125;\n&quot;</span><br><span class="line">printf &quot;总浏览量(截止到本周六[23:59:59]): $&#123;ALL_COUNT&#125;\n&quot;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 脚本 </category>
          
          <category> Shell </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Shell </tag>
            
            <tag> nginx访问日志 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mysql备份脚本</title>
      <link href="/posts/2346358873.html"/>
      <url>/posts/2346358873.html</url>
      
        <content type="html"><![CDATA[<h2 id="mysql备份脚本"><a href="#mysql备份脚本" class="headerlink" title="mysql备份脚本"></a>mysql备份脚本</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#### by jwgod 20230928</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#### mysql全库/单库备份</span></span></span><br><span class="line"></span><br><span class="line">day=`date +&#x27;%Y-%m-%d&#x27;`</span><br><span class="line">anynowtime=&quot;date +&#x27;%Y-%m-%d %H:%M:%S&#x27;&quot;</span><br><span class="line">NOW=&quot;echo [\`$anynowtime\`][PID:$$]&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#### 可在脚本开始运行时调用，打印当时的时间戳及PID。</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="keyword">function</span> job_start</span></span><br><span class="line">job_start()</span><br><span class="line">&#123;</span><br><span class="line">   echo &quot;`eval $NOW` job_start&quot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#### 可在脚本执行成功的逻辑处调用，打印当时的时间戳及PID。</span></span></span><br><span class="line">job_success()</span><br><span class="line">&#123;</span><br><span class="line">    MSG=&quot;$*&quot;</span><br><span class="line">    echo &quot;`eval $NOW` job_success:[$MSG]&quot;</span><br><span class="line">    exit 0</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#### 可在脚本执行失败的逻辑分支处调用，打印当时的时间戳及PID。</span></span></span><br><span class="line">job_fail()</span><br><span class="line">&#123;</span><br><span class="line">    MSG=&quot;$*&quot;</span><br><span class="line">    echo &quot;`eval $NOW` job_fail:[$MSG]&quot;</span><br><span class="line">    exit 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">job_start</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#### 可在此处开始编写您的脚本逻辑代码</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置mysql的登录用户名和密码(根据实际情况填写)</span></span><br><span class="line">mysql_user=&quot;root&quot;</span><br><span class="line">mysql_password=&quot;xxxx@xxxx!&quot;</span><br><span class="line">mysql_host=&quot;192.168.1.xx&quot;</span><br><span class="line">mysql_port=&quot;3306&quot;</span><br><span class="line">mysql_charset=&quot;utf8mb4&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">备份文件存放地址(根据实际情况填写)</span></span><br><span class="line">backup_location=/home/sql_bak/`date +%Y%m%d%H`</span><br><span class="line"></span><br><span class="line">test -d &quot;$backup_location&quot; || mkdir -p $backup_location</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">是否删除过期数据</span></span><br><span class="line">expire_backup_delete=&quot;ON&quot;</span><br><span class="line">expire_days=30</span><br><span class="line">backup_time=`date +%Y%m%d%H%M`</span><br><span class="line">backup_dir=$backup_location</span><br><span class="line">welcome_msg=&quot;Welcome to use MySQL backup tools!&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">判断mysql实例是否正常运行</span></span><br><span class="line">mysql_ps=`ps -ef |grep mysql |wc -l`</span><br><span class="line">mysql_listen=`netstat -an |grep LISTEN |grep $mysql_port|wc -l`</span><br><span class="line">if [ [$mysql_ps == 0] -o [$mysql_listen == 0] ]; then</span><br><span class="line">        echo &quot;ERROR:MySQL is not running! backup stop!&quot;</span><br><span class="line">        exit</span><br><span class="line">else</span><br><span class="line">        echo $welcome_msg</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#### 删除30天之前备份</span></span></span><br><span class="line">del_bak()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">删除过期数据</span></span><br><span class="line">  if [ &quot;$expire_backup_delete&quot; == &quot;ON&quot; -a  &quot;$backup_location&quot; != &quot;&quot; ];then</span><br><span class="line">    `find $backup_location -type f -mtime +$expire_days | xargs rm -rf`</span><br><span class="line">    if [ $? -eq 0 ] ; then</span><br><span class="line">      echo &quot;Expired backup data delete complete!&quot;</span><br><span class="line">      job_success &quot;$*&quot;</span><br><span class="line">    else</span><br><span class="line">      job_fail &quot;$*&quot;</span><br><span class="line">    fi  </span><br><span class="line">  fi</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#### 全库备份</span></span></span><br><span class="line">all_bak()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash"><span class="comment"># 备份指定数据库中数据(此处假设数据库是all)</span></span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">mysqldump -h<span class="variable">$mysql_host</span> -P<span class="variable">$mysql_port</span> -u<span class="variable">$mysql_user</span> -p<span class="variable">$mysql_password</span>  --all-databases --triggers --routines--events &gt; <span class="variable">$backup_dir</span>/mysql_all_backup-<span class="variable">$backup_time</span>.sql</span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">flag=`<span class="built_in">echo</span> $?`</span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash"><span class="keyword">if</span> [ <span class="variable">$flag</span> == <span class="string">&quot;0&quot;</span> ];<span class="keyword">then</span></span></span><br><span class="line">    # zip -jr $backup_dir/mysql_all_backup-$backup_time.zip $backup_dir/ --exclude &quot;*.zip&quot;</span><br><span class="line">    # #打包成功后删除sql文件</span><br><span class="line">    # if [ $? = 0 ]; then</span><br><span class="line">      # rm -rf $backup_dir/mysql_all_backup-$backup_time.sql</span><br><span class="line">    # fi</span><br><span class="line">    # echo &quot;database mysql_backup success backup to $backup_dir/mysql_backup-$backup_time.sql&quot;</span><br><span class="line">    # job_success &quot;$*&quot;</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash"><span class="keyword">else</span></span></span><br><span class="line">    # echo &quot;database mysql_backup backup fail!&quot;</span><br><span class="line">    # job_fail &quot;$*&quot;</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash"><span class="keyword">fi</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">备份的数据库数组</span></span><br><span class="line">  db_arr=$(echo &quot;show databases;&quot; | mysql -h$mysql_host -P$mysql_port -u$mysql_user -p$mysql_password |grep -v &quot;sys&quot;|grep -v &quot;Database&quot;|grep -v &quot;information_schema&quot; |grep -v &quot;performance_schema&quot;)</span><br><span class="line">  echo &quot;show databases： $db_arr&quot;</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">不需要备份的单例数据库</span></span><br><span class="line">  nodeldb=&quot;test&quot;</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">循环备份</span></span><br><span class="line">  for dbname in $&#123;db_arr&#125;</span><br><span class="line">  do</span><br><span class="line">   if [ $dbname != $nodeldb ]; then</span><br><span class="line">     echo &quot;mysqldump -h$mysql_host -P$mysql_port -u$mysql_user -p$mysql_password $dbname --master-data &gt; $backup_dir/mysql_$&#123;dbname&#125;_backup-$backup_time.sql&quot;</span><br><span class="line">     mysqldump -h$mysql_host -P$mysql_port -u$mysql_user -p$mysql_password $dbname --master-data &gt; $backup_dir/mysql_$&#123;dbname&#125;_backup-$backup_time.sql</span><br><span class="line">     flag=`echo $?`</span><br><span class="line">     if [ $flag == &quot;0&quot; ];then</span><br><span class="line">       # tar打包所有的sql文件</span><br><span class="line">       #tar -zcPpf  $backup_dir/mysql_$&#123;dbname&#125;_backup-$backup_time.zip --warning=no-file-changed --directory /   $backup_dir</span><br><span class="line">       zip -jr $backup_dir/mysql_$&#123;dbname&#125;_backup-$backup_time.zip $backup_dir/ --exclude &quot;*.zip&quot;</span><br><span class="line">       #打包成功后删除sql文件</span><br><span class="line">       if [ $? = 0 ]; then</span><br><span class="line">         rm -rf $backup_dir/mysql_$&#123;dbname&#125;_backup-$backup_time.sql</span><br><span class="line">       fi</span><br><span class="line">       echo &quot;database mysql_backup success backup to $backup_dir/mysql_$&#123;dbname&#125;_backup-$backup_time.sql&quot;</span><br><span class="line">       MSG=&quot;$*&quot;</span><br><span class="line">       echo &quot;`eval $NOW` job_success:[$MSG]&quot;</span><br><span class="line">     else</span><br><span class="line">       echo &quot;database mysql_backup backup fail!&quot;</span><br><span class="line">       job_fail &quot;$*&quot;</span><br><span class="line">     fi</span><br><span class="line">   fi</span><br><span class="line">  done</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#### 单库备份</span></span></span><br><span class="line">one_bak()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">备份指定数据库中数据(此处假设数据库是hseysh)</span></span><br><span class="line">  mysqldump -h$mysql_host -P$mysql_port -u$mysql_user -p$mysql_password $1 --master-data &gt; $backup_dir/mysql_$1_backup-$backup_time.sql</span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash"><span class="built_in">echo</span> <span class="string">&quot;mysqldump -h<span class="variable">$mysql_host</span> -P<span class="variable">$mysql_port</span> -u<span class="variable">$mysql_user</span> -p<span class="variable">$mysql_password</span> <span class="variable">$1</span> --master-data &gt; <span class="variable">$backup_dir</span>/mysql_<span class="variable">$1_backup</span>-<span class="variable">$backup_time</span>.sql&quot;</span></span></span><br><span class="line">  flag=`echo $?`</span><br><span class="line">  if [ $flag == &quot;0&quot; ];then</span><br><span class="line">    # tar打包所有的sql文件</span><br><span class="line">    # echo &quot;tar -zcPpf $backup_dir/mysql_$1_backup-$backup_time.zip --directory /   $backup_dir&quot;</span><br><span class="line">    # tar -zcPpf $backup_dir/mysql_$1_backup-$backup_time.zip --warning=no-file-changed --directory /   $backup_dir</span><br><span class="line">    zip -jr $backup_dir/mysql_$1_backup-$backup_time.zip $backup_dir/ --exclude &quot;*.zip&quot;</span><br><span class="line">    #打包成功后删除sql文件</span><br><span class="line">    if [ $? = 0 ]; then</span><br><span class="line">      echo &quot;rm -rf $backup_dir/mysql_$1_backup-$backup_time.sql&quot;</span><br><span class="line">      rm -rf $backup_dir/mysql_$1_backup-$backup_time.sql</span><br><span class="line">    fi</span><br><span class="line">    echo &quot;database mysql_backup success backup to $backup_dir/mysql_backup-$backup_time.sql&quot;</span><br><span class="line">    job_success &quot;$*&quot;</span><br><span class="line">  else</span><br><span class="line">    echo &quot;database mysql_backup backup fail!&quot;</span><br><span class="line">    job_fail &quot;$*&quot;</span><br><span class="line">  fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">job_shell()</span><br><span class="line">&#123;</span><br><span class="line">case &quot;$1&quot; in</span><br><span class="line">  0)</span><br><span class="line">    del_bak</span><br><span class="line">    ;;</span><br><span class="line">  1)</span><br><span class="line">    all_bak</span><br><span class="line">    ;;   </span><br><span class="line">  xxx_test)</span><br><span class="line">    one_bak $1</span><br><span class="line">    ;; </span><br><span class="line">  nacos)</span><br><span class="line">    one_bak $1</span><br><span class="line">    ;; </span><br><span class="line">  xxl_job)</span><br><span class="line">    one_bak $1</span><br><span class="line">  *)</span><br><span class="line">    echo &quot;Usage: $0 &#123;0[删除30天之前备份]|1[全备]|单库名[ xxxx_test | nacos | xxl_job ]&#125;&quot;</span><br><span class="line">    exit 1</span><br><span class="line"></span><br><span class="line">esac</span><br><span class="line">exit 0    </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#### 作业平台中执行脚本成功和失败的标准只取决于脚本最后一条执行语句的返回值</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#### 如果返回值为0，则认为此脚本执行成功，如果非0，则认为脚本执行失败</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">read</span> -r -p <span class="string">&quot;请选择全库/单库备份：｛0[删除30天之前备份]|1[全备]|单库名[ xxxx_test | nacos | xxl_job]｝&quot;</span> bak_sh</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">job_shell <span class="string">&quot;<span class="variable">$bak_sh</span>&quot;</span></span></span><br><span class="line">all_bak</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">echo</span> <span class="string">&quot;mysql备份的第一个版本! &quot;</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">echo</span> <span class="string">&quot;version: 1.0.0&quot;</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 脚本 </category>
          
          <category> Shell </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Shell </tag>
            
            <tag> mysql 备份 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MongoDb</title>
      <link href="/posts/3049486006.html"/>
      <url>/posts/3049486006.html</url>
      
        <content type="html"><![CDATA[<h2 id="1-安装"><a href="#1-安装" class="headerlink" title="1 安装"></a>1 安装</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cd /home/software</span><br><span class="line">tar xzf mongodb-linux-x86_64-enterprise-rhel80-4.4.24.tgz</span><br><span class="line"></span><br><span class="line">mkdir -p /home/mongodb/mongodb1</span><br><span class="line">cp -r /home/software/mongodb-linux-x86_64-enterprise-rhel80-4.4.24/* /home/mongodb/mongodb1/</span><br><span class="line"></span><br><span class="line">cp -r /home/mongodb/mongodb1 /home/mongodb/mongodb2</span><br><span class="line">cp -r /home/mongodb/mongodb1 /home/mongodb/mongodb3</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="2-启动mongodb"><a href="#2-启动mongodb" class="headerlink" title="2 启动mongodb"></a>2 启动mongodb</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">配置示例</span></span><br><span class="line">cat mongodb_24017/conf/mongodb_24017.yml </span><br><span class="line">systemLog:</span><br><span class="line">  destination: file</span><br><span class="line">  logAppend: true</span><br><span class="line">  path: /home/mongodb/mongodb_24017/logs/mongodb.log</span><br><span class="line"></span><br><span class="line">replication:</span><br><span class="line">  replSetName: mgo</span><br><span class="line"></span><br><span class="line">storage:</span><br><span class="line">  journal:</span><br><span class="line">    enabled: true</span><br><span class="line">  dbPath: /home/mongodb/mongodb_24017/data</span><br><span class="line">  directoryPerDB: true</span><br><span class="line">  wiredTiger:</span><br><span class="line">    engineConfig:</span><br><span class="line">      cacheSizeGB: 1</span><br><span class="line">      directoryForIndexes: true</span><br><span class="line">    collectionConfig:</span><br><span class="line">      blockCompressor: zlib</span><br><span class="line">    indexConfig:</span><br><span class="line">      prefixCompression: true</span><br><span class="line"></span><br><span class="line">processManagement:</span><br><span class="line">  fork: true</span><br><span class="line">  pidFilePath: /home/mongodb/mongodb_24017/pid/mongod.pid</span><br><span class="line"></span><br><span class="line">net:</span><br><span class="line">  port: 24017</span><br><span class="line">  bindIp: 0.0.0.0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mongodb1</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">vim /usr/lib/systemd/system/mongodb1.service</span> </span><br><span class="line">[Unit] </span><br><span class="line">Description=mongodb1</span><br><span class="line">After=network.target remote-fs.target nss-lookup.target</span><br><span class="line"></span><br><span class="line">[Service] </span><br><span class="line">Type=forking</span><br><span class="line">User=root</span><br><span class="line">Group=root</span><br><span class="line">ExecStart=/home/mongodb/mongodb_24017/bin/mongod --config /home/mongodb/mongodb_24017/conf/mongodb_24017.yml</span><br><span class="line">ExecReload=/bin/kill -HUP $MAINPID </span><br><span class="line">ExecStop=/home/mongodb/mongodb_24017/bin/mongod --shutdown /home/mongodb/mongodb_24017/conf/mongodb_24017.yml</span><br><span class="line">PrivateTmp=true</span><br><span class="line">KillMode=process </span><br><span class="line">Restart=on-failure</span><br><span class="line"></span><br><span class="line">[Install] </span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mongodb2</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">vim /usr/lib/systemd/system/mongodb2.service</span> </span><br><span class="line">[Unit] </span><br><span class="line">Description=mongodb2</span><br><span class="line">After=network.target remote-fs.target nss-lookup.target</span><br><span class="line"></span><br><span class="line">[Service] </span><br><span class="line">Type=forking</span><br><span class="line">User=root</span><br><span class="line">Group=root</span><br><span class="line">ExecStart=/home/mongodb/mongodb_26017/bin/mongod --config /home/mongodb/mongodb_26017/conf/mongodb_26017.yml</span><br><span class="line">ExecReload=/bin/kill -HUP $MAINPID </span><br><span class="line">ExecStop=/home/mongodb/mongodb_26017/bin/mongod --shutdown /home/mongodb/mongodb_26017/conf/mongodb_26017.yml</span><br><span class="line">PrivateTmp=true</span><br><span class="line">KillMode=process </span><br><span class="line">Restart=on-failure</span><br><span class="line"></span><br><span class="line">[Install] </span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mongodb3</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">vim /usr/lib/systemd/system/mongodb3.service</span> </span><br><span class="line">[Unit] </span><br><span class="line">Description=mongodb3</span><br><span class="line">After=network.target remote-fs.target nss-lookup.target</span><br><span class="line"></span><br><span class="line">[Service] </span><br><span class="line">Type=forking</span><br><span class="line">User=root</span><br><span class="line">Group=root</span><br><span class="line">ExecStart=/home/mongodb/mongodb_25017/bin/mongod --config /home/mongodb/mongodb_25017/conf/mongodb_25017.yml</span><br><span class="line">ExecReload=/bin/kill -HUP $MAINPID </span><br><span class="line">ExecStop=/home/mongodb/mongodb_25017/bin/mongod --shutdown /home/mongodb/mongodb_25017/conf/mongodb_25017.yml</span><br><span class="line">PrivateTmp=true</span><br><span class="line">KillMode=process </span><br><span class="line">Restart=on-failure</span><br><span class="line"></span><br><span class="line">[Install] </span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart mongodb1  # 24017</span><br><span class="line">systemctl restart mongodb2  # 26017</span><br><span class="line">systemctl restart mongodb3  # 25017</span><br><span class="line"></span><br><span class="line">ps -ef |grep mongod</span><br></pre></td></tr></table></figure><h2 id="3-初始化复制集"><a href="#3-初始化复制集" class="headerlink" title="3 初始化复制集"></a>3 初始化复制集</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line">vim /home/mongodb/mongo_init_replset</span><br><span class="line">cfg=&#123; _id:&quot;mgo&quot;,members:[ &#123;_id:0,host:&#x27;127.0.0.1:24017&#x27;&#125;,&#123;_id:1,host:&#x27;127.0.0.1:26017&#x27;&#125;,&#123;_id:2,host:&#x27;127.0.0.1:25017&#x27;&#125;] &#125;;</span><br><span class="line">rs.initiate(cfg);</span><br><span class="line">rs.status();</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">参数说明：</span></span><br><span class="line">_id：复制集名称（第一个_id） </span><br><span class="line">members：复制集服务器列表 </span><br><span class="line">_id：服务器的唯一ID（数组里_id） </span><br><span class="line">host：服务器主机</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在其中一台机器上执行。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">执行命令及返回：</span></span><br><span class="line">/home/mongodb/mongodb_24017/bin/mongo 127.0.0.1:24017 &lt; /home/mongodb/mongo_init_replset</span><br><span class="line">MongoDB shell version v4.0.4</span><br><span class="line">connecting to: mongodb://127.0.0.1:24017/test</span><br><span class="line">Implicit session: session &#123; &quot;id&quot; : UUID(&quot;c9d3449e-afd2-4d48-ac4d-19b9981667c8&quot;) &#125;</span><br><span class="line">MongoDB server version: 4.0.4</span><br><span class="line">&#123;</span><br><span class="line">&quot;_id&quot; : &quot;mgo&quot;,</span><br><span class="line">&quot;members&quot; : [</span><br><span class="line">&#123;</span><br><span class="line">&quot;_id&quot; : 0,</span><br><span class="line">&quot;host&quot; : &quot;127.0.0.1:24017&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;_id&quot; : 1,</span><br><span class="line">&quot;host&quot; : &quot;127.0.0.1:26017&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;_id&quot; : 2,</span><br><span class="line">&quot;host&quot; : &quot;127.0.0.1:25017&quot;</span><br><span class="line">&#125;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">&quot;operationTime&quot; : Timestamp(1700884573, 1),</span><br><span class="line">&quot;ok&quot; : 0,</span><br><span class="line">&quot;errmsg&quot; : &quot;already initialized&quot;,</span><br><span class="line">&quot;code&quot; : 23,</span><br><span class="line">&quot;codeName&quot; : &quot;AlreadyInitialized&quot;,</span><br><span class="line">&quot;$clusterTime&quot; : &#123;</span><br><span class="line">&quot;clusterTime&quot; : Timestamp(1700884573, 1),</span><br><span class="line">&quot;signature&quot; : &#123;</span><br><span class="line">&quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;),</span><br><span class="line">&quot;keyId&quot; : NumberLong(0)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">&quot;set&quot; : &quot;mgo&quot;,</span><br><span class="line">&quot;date&quot; : ISODate(&quot;2023-11-25T03:56:21.257Z&quot;),</span><br><span class="line">&quot;myState&quot; : 1,</span><br><span class="line">&quot;term&quot; : NumberLong(1),</span><br><span class="line">&quot;syncingTo&quot; : &quot;&quot;,</span><br><span class="line">&quot;syncSourceHost&quot; : &quot;&quot;,</span><br><span class="line">&quot;syncSourceId&quot; : -1,</span><br><span class="line">&quot;heartbeatIntervalMillis&quot; : NumberLong(2000),</span><br><span class="line">&quot;optimes&quot; : &#123;</span><br><span class="line">&quot;lastCommittedOpTime&quot; : &#123;</span><br><span class="line">&quot;ts&quot; : Timestamp(1700884573, 1),</span><br><span class="line">&quot;t&quot; : NumberLong(1)</span><br><span class="line">&#125;,</span><br><span class="line">&quot;readConcernMajorityOpTime&quot; : &#123;</span><br><span class="line">&quot;ts&quot; : Timestamp(1700884573, 1),</span><br><span class="line">&quot;t&quot; : NumberLong(1)</span><br><span class="line">&#125;,</span><br><span class="line">&quot;appliedOpTime&quot; : &#123;</span><br><span class="line">&quot;ts&quot; : Timestamp(1700884573, 1),</span><br><span class="line">&quot;t&quot; : NumberLong(1)</span><br><span class="line">&#125;,</span><br><span class="line">&quot;durableOpTime&quot; : &#123;</span><br><span class="line">&quot;ts&quot; : Timestamp(1700884573, 1),</span><br><span class="line">&quot;t&quot; : NumberLong(1)</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;lastStableCheckpointTimestamp&quot; : Timestamp(1700884533, 1),</span><br><span class="line">&quot;members&quot; : [</span><br><span class="line">&#123;</span><br><span class="line">&quot;_id&quot; : 0,</span><br><span class="line">&quot;name&quot; : &quot;127.0.0.1:24017&quot;,</span><br><span class="line">&quot;health&quot; : 1,</span><br><span class="line">&quot;state&quot; : 1,</span><br><span class="line">&quot;stateStr&quot; : &quot;PRIMARY&quot;,</span><br><span class="line">&quot;uptime&quot; : 923,</span><br><span class="line">&quot;optime&quot; : &#123;</span><br><span class="line">&quot;ts&quot; : Timestamp(1700884573, 1),</span><br><span class="line">&quot;t&quot; : NumberLong(1)</span><br><span class="line">&#125;,</span><br><span class="line">&quot;optimeDate&quot; : ISODate(&quot;2023-11-25T03:56:13Z&quot;),</span><br><span class="line">&quot;syncingTo&quot; : &quot;&quot;,</span><br><span class="line">&quot;syncSourceHost&quot; : &quot;&quot;,</span><br><span class="line">&quot;syncSourceId&quot; : -1,</span><br><span class="line">&quot;infoMessage&quot; : &quot;&quot;,</span><br><span class="line">&quot;electionTime&quot; : Timestamp(1700883811, 1),</span><br><span class="line">&quot;electionDate&quot; : ISODate(&quot;2023-11-25T03:43:31Z&quot;),</span><br><span class="line">&quot;configVersion&quot; : 1,</span><br><span class="line">&quot;self&quot; : true,</span><br><span class="line">&quot;lastHeartbeatMessage&quot; : &quot;&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;_id&quot; : 1,</span><br><span class="line">&quot;name&quot; : &quot;127.0.0.1:26017&quot;,</span><br><span class="line">&quot;health&quot; : 1,</span><br><span class="line">&quot;state&quot; : 2,</span><br><span class="line">&quot;stateStr&quot; : &quot;SECONDARY&quot;,</span><br><span class="line">&quot;uptime&quot; : 780,</span><br><span class="line">&quot;optime&quot; : &#123;</span><br><span class="line">&quot;ts&quot; : Timestamp(1700884573, 1),</span><br><span class="line">&quot;t&quot; : NumberLong(1)</span><br><span class="line">&#125;,</span><br><span class="line">&quot;optimeDurable&quot; : &#123;</span><br><span class="line">&quot;ts&quot; : Timestamp(1700884573, 1),</span><br><span class="line">&quot;t&quot; : NumberLong(1)</span><br><span class="line">&#125;,</span><br><span class="line">&quot;optimeDate&quot; : ISODate(&quot;2023-11-25T03:56:13Z&quot;),</span><br><span class="line">&quot;optimeDurableDate&quot; : ISODate(&quot;2023-11-25T03:56:13Z&quot;),</span><br><span class="line">&quot;lastHeartbeat&quot; : ISODate(&quot;2023-11-25T03:56:19.301Z&quot;),</span><br><span class="line">&quot;lastHeartbeatRecv&quot; : ISODate(&quot;2023-11-25T03:56:20.154Z&quot;),</span><br><span class="line">&quot;pingMs&quot; : NumberLong(0),</span><br><span class="line">&quot;lastHeartbeatMessage&quot; : &quot;&quot;,</span><br><span class="line">&quot;syncingTo&quot; : &quot;127.0.0.1:24017&quot;,</span><br><span class="line">&quot;syncSourceHost&quot; : &quot;127.0.0.1:24017&quot;,</span><br><span class="line">&quot;syncSourceId&quot; : 0,</span><br><span class="line">&quot;infoMessage&quot; : &quot;&quot;,</span><br><span class="line">&quot;configVersion&quot; : 1</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;_id&quot; : 2,</span><br><span class="line">&quot;name&quot; : &quot;127.0.0.1:25017&quot;,</span><br><span class="line">&quot;health&quot; : 1,</span><br><span class="line">&quot;state&quot; : 2,</span><br><span class="line">&quot;stateStr&quot; : &quot;SECONDARY&quot;,</span><br><span class="line">&quot;uptime&quot; : 780,</span><br><span class="line">&quot;optime&quot; : &#123;</span><br><span class="line">&quot;ts&quot; : Timestamp(1700884573, 1),</span><br><span class="line">&quot;t&quot; : NumberLong(1)</span><br><span class="line">&#125;,</span><br><span class="line">&quot;optimeDurable&quot; : &#123;</span><br><span class="line">&quot;ts&quot; : Timestamp(1700884573, 1),</span><br><span class="line">&quot;t&quot; : NumberLong(1)</span><br><span class="line">&#125;,</span><br><span class="line">&quot;optimeDate&quot; : ISODate(&quot;2023-11-25T03:56:13Z&quot;),</span><br><span class="line">&quot;optimeDurableDate&quot; : ISODate(&quot;2023-11-25T03:56:13Z&quot;),</span><br><span class="line">&quot;lastHeartbeat&quot; : ISODate(&quot;2023-11-25T03:56:19.301Z&quot;),</span><br><span class="line">&quot;lastHeartbeatRecv&quot; : ISODate(&quot;2023-11-25T03:56:20.187Z&quot;),</span><br><span class="line">&quot;pingMs&quot; : NumberLong(0),</span><br><span class="line">&quot;lastHeartbeatMessage&quot; : &quot;&quot;,</span><br><span class="line">&quot;syncingTo&quot; : &quot;127.0.0.1:24017&quot;,</span><br><span class="line">&quot;syncSourceHost&quot; : &quot;127.0.0.1:24017&quot;,</span><br><span class="line">&quot;syncSourceId&quot; : 0,</span><br><span class="line">&quot;infoMessage&quot; : &quot;&quot;,</span><br><span class="line">&quot;configVersion&quot; : 1</span><br><span class="line">&#125;</span><br><span class="line">],</span><br><span class="line">&quot;ok&quot; : 1,</span><br><span class="line">&quot;operationTime&quot; : Timestamp(1700884573, 1),</span><br><span class="line">&quot;$clusterTime&quot; : &#123;</span><br><span class="line">&quot;clusterTime&quot; : Timestamp(1700884573, 1),</span><br><span class="line">&quot;signature&quot; : &#123;</span><br><span class="line">&quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;),</span><br><span class="line">&quot;keyId&quot; : NumberLong(0)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">bye</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">生产环境</span></span><br><span class="line">/home/mongodb/mongodb_27017/bin/mongo 127.0.0.1:27017 &lt; /home/mongodb/mongo_init_replset</span><br></pre></td></tr></table></figure><h2 id="4-初始化用户和密码"><a href="#4-初始化用户和密码" class="headerlink" title="4 初始化用户和密码"></a>4 初始化用户和密码</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">需要在集群的primary节点执行。根据初始化的副本集信息，可以获取到primary节点信息，找到PRIMARY对应的节点ip地址。</span><br><span class="line">...</span><br><span class="line">&quot;_id&quot; : 0,</span><br><span class="line">&quot;name&quot; : &quot;127.0.0.1:24017&quot;,</span><br><span class="line">&quot;health&quot; : 1,</span><br><span class="line">&quot;state&quot; : 1,</span><br><span class="line">&quot;stateStr&quot; : &quot;PRIMARY&quot;,</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">vim /home/mongodb/mongo_init_user</span><br><span class="line">use admin;</span><br><span class="line">db.createUser(&#123; user: &quot;admin&quot;, pwd: &quot;jwgod@123&quot;, roles: [ &#123; role: &quot;readWriteAnyDatabase&quot;, db: &quot;admin&quot; &#125; ] &#125;);</span><br><span class="line">db.grantRolesToUser(&quot;admin&quot;, [&quot;clusterAdmin&quot;]);</span><br><span class="line">db.grantRolesToUser(&quot;admin&quot;, [&quot;clusterManager&quot;]);</span><br><span class="line">db.grantRolesToUser(&quot;admin&quot;, [&quot;clusterMonitor&quot;]);</span><br><span class="line">db.grantRolesToUser(&quot;admin&quot;, [&quot;hostManager&quot;]);</span><br><span class="line">db.grantRolesToUser(&quot;admin&quot;, [&quot;userAdminAnyDatabase&quot;]);</span><br><span class="line">db.grantRolesToUser(&quot;admin&quot;, [&quot;dbAdmin&quot;]);</span><br><span class="line">db.grantRolesToUser(&quot;admin&quot;, [&quot;dbOwner&quot;]);</span><br><span class="line">show users;</span><br><span class="line">use golog;</span><br><span class="line">db.createUser(&#123; user: &quot;jwgod&quot;, pwd: &quot;jwgod@123&quot;, roles: [ &#123; role: &quot;readWriteAnyDatabase&quot;, db: &quot;admin&quot; &#125; ] &#125;);</span><br><span class="line">use crm;</span><br><span class="line">db.createUser(&#123; user: &quot;crmUser&quot;, pwd: &quot;jwgod,123&quot;, roles: [ &#123; role: &quot;readWriteAnyDatabase&quot;, db: &quot;crm&quot; &#125; ] &#125;);</span><br><span class="line">use price</span><br><span class="line">db.createUser(&#123; user: &quot;priceUser&quot;, pwd: &quot;price,123&quot;, roles: [ &#123; role: &quot;readWriteAnyDatabase&quot;, db: &quot;price&quot; &#125; ] &#125;);</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">执行命令如下。</span></span><br><span class="line">/home/mongodb/mongodb_24017/bin/mongo 127.0.0.1:24017 &lt; /home/mongodb/mongo_init_user</span><br><span class="line">MongoDB shell version v4.0.4</span><br><span class="line">connecting to: mongodb://127.0.0.1:24017/test</span><br><span class="line">Implicit session: session &#123; &quot;id&quot; : UUID(&quot;deead2d8-7337-45a0-968d-8a4fa27961ba&quot;) &#125;</span><br><span class="line">MongoDB server version: 4.0.4</span><br><span class="line">switched to db admin</span><br><span class="line">Successfully added user: &#123;</span><br><span class="line">&quot;user&quot; : &quot;admin&quot;,</span><br><span class="line">&quot;roles&quot; : [</span><br><span class="line">&#123;</span><br><span class="line">&quot;role&quot; : &quot;readWriteAnyDatabase&quot;,</span><br><span class="line">&quot;db&quot; : &quot;admin&quot;</span><br><span class="line">&#125;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">&quot;_id&quot; : &quot;admin.admin&quot;,</span><br><span class="line">&quot;user&quot; : &quot;admin&quot;,</span><br><span class="line">&quot;db&quot; : &quot;admin&quot;,</span><br><span class="line">&quot;roles&quot; : [</span><br><span class="line">&#123;</span><br><span class="line">&quot;role&quot; : &quot;dbOwner&quot;,</span><br><span class="line">&quot;db&quot; : &quot;admin&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;role&quot; : &quot;dbAdmin&quot;,</span><br><span class="line">&quot;db&quot; : &quot;admin&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;role&quot; : &quot;readWriteAnyDatabase&quot;,</span><br><span class="line">&quot;db&quot; : &quot;admin&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;role&quot; : &quot;clusterAdmin&quot;,</span><br><span class="line">&quot;db&quot; : &quot;admin&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;role&quot; : &quot;clusterManager&quot;,</span><br><span class="line">&quot;db&quot; : &quot;admin&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;role&quot; : &quot;userAdminAnyDatabase&quot;,</span><br><span class="line">&quot;db&quot; : &quot;admin&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;role&quot; : &quot;hostManager&quot;,</span><br><span class="line">&quot;db&quot; : &quot;admin&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;role&quot; : &quot;clusterMonitor&quot;,</span><br><span class="line">&quot;db&quot; : &quot;admin&quot;</span><br><span class="line">&#125;</span><br><span class="line">],</span><br><span class="line">&quot;mechanisms&quot; : [</span><br><span class="line">&quot;SCRAM-SHA-1&quot;,</span><br><span class="line">&quot;SCRAM-SHA-256&quot;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br><span class="line">switched to db golog</span><br><span class="line">Successfully added user: &#123;</span><br><span class="line">&quot;user&quot; : &quot;jwgod&quot;,</span><br><span class="line">&quot;roles&quot; : [</span><br><span class="line">&#123;</span><br><span class="line">&quot;role&quot; : &quot;readWriteAnyDatabase&quot;,</span><br><span class="line">&quot;db&quot; : &quot;admin&quot;</span><br><span class="line">&#125;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br><span class="line">switched to db crm</span><br><span class="line">Successfully added user: &#123;</span><br><span class="line">&quot;user&quot; : &quot;crmUser&quot;,</span><br><span class="line">&quot;roles&quot; : [</span><br><span class="line">&#123;</span><br><span class="line">&quot;role&quot; : &quot;readWriteAnyDatabase&quot;,</span><br><span class="line">&quot;db&quot; : &quot;crm&quot;</span><br><span class="line">&#125;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br><span class="line">switched to db price</span><br><span class="line">Successfully added user: &#123;</span><br><span class="line">&quot;user&quot; : &quot;priceUser&quot;,</span><br><span class="line">&quot;roles&quot; : [</span><br><span class="line">&#123;</span><br><span class="line">&quot;role&quot; : &quot;readWriteAnyDatabase&quot;,</span><br><span class="line">&quot;db&quot; : &quot;price&quot;</span><br><span class="line">&#125;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br><span class="line">bye</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">生产环境</span></span><br><span class="line">/home/mongodb/mongodb_27017/bin/mongo 127.0.0.1:27017 &lt; /home/mongodb/mongo_init_user</span><br></pre></td></tr></table></figure><h2 id="5-重启mongodb"><a href="#5-重启mongodb" class="headerlink" title="5 重启mongodb"></a>5 重启mongodb</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart mongodb1  # 24017</span><br><span class="line">systemctl restart mongodb2  # 26017</span><br><span class="line">systemctl restart mongodb3  # 25017</span><br><span class="line"></span><br><span class="line">ps -ef |grep mongod</span><br></pre></td></tr></table></figure><h2 id="6-验证集群"><a href="#6-验证集群" class="headerlink" title="6 验证集群"></a>6 验证集群</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br></pre></td><td class="code"><pre><span class="line">需要在集群的primary节点执行</span><br><span class="line">vim /home/mongodb/mongo_status</span><br><span class="line">use admin;</span><br><span class="line">db.auth(&quot;admin&quot;,&quot;jwgod@123&quot;);</span><br><span class="line">db.system.users.find().pretty();</span><br><span class="line">rs.status();</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">执行命令如下：</span></span><br><span class="line">/home/mongodb/mongodb_24017/bin/mongo 127.0.0.1:24017  &lt; /home/mongodb/mongo_status</span><br><span class="line">MongoDB shell version v4.0.4</span><br><span class="line">connecting to: mongodb://127.0.0.1:24017/test</span><br><span class="line">Implicit session: session &#123; &quot;id&quot; : UUID(&quot;f9c9a94e-44c6-4251-9cf5-0530ab61ad7d&quot;) &#125;</span><br><span class="line">MongoDB server version: 4.0.4</span><br><span class="line">switched to db admin</span><br><span class="line">1</span><br><span class="line">&#123;</span><br><span class="line">&quot;_id&quot; : &quot;admin.admin&quot;,</span><br><span class="line">&quot;user&quot; : &quot;admin&quot;,</span><br><span class="line">&quot;db&quot; : &quot;admin&quot;,</span><br><span class="line">&quot;credentials&quot; : &#123;</span><br><span class="line">&quot;SCRAM-SHA-1&quot; : &#123;</span><br><span class="line">&quot;iterationCount&quot; : 10000,</span><br><span class="line">&quot;salt&quot; : &quot;4LzccFQWe/pHAWa2M0uMHw==&quot;,</span><br><span class="line">&quot;storedKey&quot; : &quot;lx1PpSuUs0jxb/HfXoSYMcQBRZo=&quot;,</span><br><span class="line">&quot;serverKey&quot; : &quot;cwLT63qoFj5psHAVHS+zsBocMZ4=&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;SCRAM-SHA-256&quot; : &#123;</span><br><span class="line">&quot;iterationCount&quot; : 15000,</span><br><span class="line">&quot;salt&quot; : &quot;cG/qx45WdyVD6kKhE0LswmxbXE9zHjd0U43Y2A==&quot;,</span><br><span class="line">&quot;storedKey&quot; : &quot;B7DhuERflmIu0Hlt7c6UxYHY4W5U9PnmkMGVaJiLmwY=&quot;,</span><br><span class="line">&quot;serverKey&quot; : &quot;nsTJMj/U3kE/bbBF8TteWghrAQjavMqIOxgR+J7R2iI=&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;roles&quot; : [</span><br><span class="line">&#123;</span><br><span class="line">&quot;role&quot; : &quot;dbOwner&quot;,</span><br><span class="line">&quot;db&quot; : &quot;admin&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;role&quot; : &quot;dbAdmin&quot;,</span><br><span class="line">&quot;db&quot; : &quot;admin&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;role&quot; : &quot;readWriteAnyDatabase&quot;,</span><br><span class="line">&quot;db&quot; : &quot;admin&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;role&quot; : &quot;clusterAdmin&quot;,</span><br><span class="line">&quot;db&quot; : &quot;admin&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;role&quot; : &quot;clusterManager&quot;,</span><br><span class="line">&quot;db&quot; : &quot;admin&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;role&quot; : &quot;userAdminAnyDatabase&quot;,</span><br><span class="line">&quot;db&quot; : &quot;admin&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;role&quot; : &quot;hostManager&quot;,</span><br><span class="line">&quot;db&quot; : &quot;admin&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;role&quot; : &quot;clusterMonitor&quot;,</span><br><span class="line">&quot;db&quot; : &quot;admin&quot;</span><br><span class="line">&#125;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">&quot;_id&quot; : &quot;golog.qmsMongodb&quot;,</span><br><span class="line">&quot;user&quot; : &quot;jwgod&quot;,</span><br><span class="line">&quot;db&quot; : &quot;golog&quot;,</span><br><span class="line">&quot;credentials&quot; : &#123;</span><br><span class="line">&quot;SCRAM-SHA-1&quot; : &#123;</span><br><span class="line">&quot;iterationCount&quot; : 10000,</span><br><span class="line">&quot;salt&quot; : &quot;uLNAPv9iJYtfo5izj+XHBg==&quot;,</span><br><span class="line">&quot;storedKey&quot; : &quot;CH/0tckYdtrcIjYjhGRH5YLkeCs=&quot;,</span><br><span class="line">&quot;serverKey&quot; : &quot;pWGc6n2GaAK1VMU5SHw7BdTsv8o=&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;SCRAM-SHA-256&quot; : &#123;</span><br><span class="line">&quot;iterationCount&quot; : 15000,</span><br><span class="line">&quot;salt&quot; : &quot;8FAGu0lxbCmUgVMl1VwVWlqIpXQfwSZe+RmzUg==&quot;,</span><br><span class="line">&quot;storedKey&quot; : &quot;WdZRbLXpicfynKtdsaL9qcW5q2kdB1+0SVx6sEEw9eo=&quot;,</span><br><span class="line">&quot;serverKey&quot; : &quot;0GVf8iRdxRMIwqiZqpT2nGn7bCs3WYch6bkaYhTv5yQ=&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;roles&quot; : [</span><br><span class="line">&#123;</span><br><span class="line">&quot;role&quot; : &quot;readWriteAnyDatabase&quot;,</span><br><span class="line">&quot;db&quot; : &quot;admin&quot;</span><br><span class="line">&#125;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">&quot;_id&quot; : &quot;crm.crmUser&quot;,</span><br><span class="line">&quot;user&quot; : &quot;crmUser&quot;,</span><br><span class="line">&quot;db&quot; : &quot;crm&quot;,</span><br><span class="line">&quot;credentials&quot; : &#123;</span><br><span class="line">&quot;SCRAM-SHA-1&quot; : &#123;</span><br><span class="line">&quot;iterationCount&quot; : 10000,</span><br><span class="line">&quot;salt&quot; : &quot;nzd8Kf3z/o2qSlmRjeM1yw==&quot;,</span><br><span class="line">&quot;storedKey&quot; : &quot;cPrhr3mUBiUSYX+WjHdfZu98mdQ=&quot;,</span><br><span class="line">&quot;serverKey&quot; : &quot;aT3IPtF3uqQ2lB0kedQPYJxov4Y=&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;SCRAM-SHA-256&quot; : &#123;</span><br><span class="line">&quot;iterationCount&quot; : 15000,</span><br><span class="line">&quot;salt&quot; : &quot;11k3+Wbo7p7smPIjh21xtCDTiwAAJivmiibrag==&quot;,</span><br><span class="line">&quot;storedKey&quot; : &quot;UbrmPJQWhnKIXRD5TT41vUVAH6WECX/0mEZBzV8URmI=&quot;,</span><br><span class="line">&quot;serverKey&quot; : &quot;WsLpI4KmKC+zJS1fCVzpclAyKBLdGb84rmbZzPt7UjA=&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;roles&quot; : [</span><br><span class="line">&#123;</span><br><span class="line">&quot;role&quot; : &quot;readWriteAnyDatabase&quot;,</span><br><span class="line">&quot;db&quot; : &quot;admin&quot;</span><br><span class="line">&#125;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">&quot;_id&quot; : &quot;price.priceUser&quot;,</span><br><span class="line">&quot;user&quot; : &quot;priceUser&quot;,</span><br><span class="line">&quot;db&quot; : &quot;price&quot;,</span><br><span class="line">&quot;credentials&quot; : &#123;</span><br><span class="line">&quot;SCRAM-SHA-1&quot; : &#123;</span><br><span class="line">&quot;iterationCount&quot; : 10000,</span><br><span class="line">&quot;salt&quot; : &quot;bofvFKoqXYODB0XTZZA8aw==&quot;,</span><br><span class="line">&quot;storedKey&quot; : &quot;8KCS/O3aMEHYCDoJZUyl/EP0k2k=&quot;,</span><br><span class="line">&quot;serverKey&quot; : &quot;PC559iJa7wmVDN7UjqZSc04CLZI=&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;SCRAM-SHA-256&quot; : &#123;</span><br><span class="line">&quot;iterationCount&quot; : 15000,</span><br><span class="line">&quot;salt&quot; : &quot;SRr1GmvgaCTXr+ePhZxj7WskSGLp4HHkS1n3nQ==&quot;,</span><br><span class="line">&quot;storedKey&quot; : &quot;E+yzlIQQZF0FdyHmD3GuITdYXgQF8Dl5pZK4LexFdnM=&quot;,</span><br><span class="line">&quot;serverKey&quot; : &quot;tgwiIypApCmO2prz/OMVFp1r6OgSEicueEEeTJn9ERI=&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;roles&quot; : [</span><br><span class="line">&#123;</span><br><span class="line">&quot;role&quot; : &quot;readWriteAnyDatabase&quot;,</span><br><span class="line">&quot;db&quot; : &quot;admin&quot;</span><br><span class="line">&#125;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">&quot;set&quot; : &quot;mgo&quot;,</span><br><span class="line">&quot;date&quot; : ISODate(&quot;2023-11-25T04:05:37.501Z&quot;),</span><br><span class="line">&quot;myState&quot; : 1,</span><br><span class="line">&quot;term&quot; : NumberLong(2),</span><br><span class="line">&quot;syncingTo&quot; : &quot;&quot;,</span><br><span class="line">&quot;syncSourceHost&quot; : &quot;&quot;,</span><br><span class="line">&quot;syncSourceId&quot; : -1,</span><br><span class="line">&quot;heartbeatIntervalMillis&quot; : NumberLong(2000),</span><br><span class="line">&quot;optimes&quot; : &#123;</span><br><span class="line">&quot;lastCommittedOpTime&quot; : &#123;</span><br><span class="line">&quot;ts&quot; : Timestamp(1700885131, 1),</span><br><span class="line">&quot;t&quot; : NumberLong(2)</span><br><span class="line">&#125;,</span><br><span class="line">&quot;readConcernMajorityOpTime&quot; : &#123;</span><br><span class="line">&quot;ts&quot; : Timestamp(1700885131, 1),</span><br><span class="line">&quot;t&quot; : NumberLong(2)</span><br><span class="line">&#125;,</span><br><span class="line">&quot;appliedOpTime&quot; : &#123;</span><br><span class="line">&quot;ts&quot; : Timestamp(1700885131, 1),</span><br><span class="line">&quot;t&quot; : NumberLong(2)</span><br><span class="line">&#125;,</span><br><span class="line">&quot;durableOpTime&quot; : &#123;</span><br><span class="line">&quot;ts&quot; : Timestamp(1700885131, 1),</span><br><span class="line">&quot;t&quot; : NumberLong(2)</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;lastStableCheckpointTimestamp&quot; : Timestamp(1700885111, 1),</span><br><span class="line">&quot;members&quot; : [</span><br><span class="line">&#123;</span><br><span class="line">&quot;_id&quot; : 0,</span><br><span class="line">&quot;name&quot; : &quot;127.0.0.1:24017&quot;,</span><br><span class="line">&quot;health&quot; : 1,</span><br><span class="line">&quot;state&quot; : 1,</span><br><span class="line">&quot;stateStr&quot; : &quot;PRIMARY&quot;,</span><br><span class="line">&quot;uptime&quot; : 139,</span><br><span class="line">&quot;optime&quot; : &#123;</span><br><span class="line">&quot;ts&quot; : Timestamp(1700885131, 1),</span><br><span class="line">&quot;t&quot; : NumberLong(2)</span><br><span class="line">&#125;,</span><br><span class="line">&quot;optimeDate&quot; : ISODate(&quot;2023-11-25T04:05:31Z&quot;),</span><br><span class="line">&quot;syncingTo&quot; : &quot;&quot;,</span><br><span class="line">&quot;syncSourceHost&quot; : &quot;&quot;,</span><br><span class="line">&quot;syncSourceId&quot; : -1,</span><br><span class="line">&quot;infoMessage&quot; : &quot;&quot;,</span><br><span class="line">&quot;electionTime&quot; : Timestamp(1700885010, 1),</span><br><span class="line">&quot;electionDate&quot; : ISODate(&quot;2023-11-25T04:03:30Z&quot;),</span><br><span class="line">&quot;configVersion&quot; : 1,</span><br><span class="line">&quot;self&quot; : true,</span><br><span class="line">&quot;lastHeartbeatMessage&quot; : &quot;&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;_id&quot; : 1,</span><br><span class="line">&quot;name&quot; : &quot;127.0.0.1:26017&quot;,</span><br><span class="line">&quot;health&quot; : 1,</span><br><span class="line">&quot;state&quot; : 2,</span><br><span class="line">&quot;stateStr&quot; : &quot;SECONDARY&quot;,</span><br><span class="line">&quot;uptime&quot; : 132,</span><br><span class="line">&quot;optime&quot; : &#123;</span><br><span class="line">&quot;ts&quot; : Timestamp(1700885131, 1),</span><br><span class="line">&quot;t&quot; : NumberLong(2)</span><br><span class="line">&#125;,</span><br><span class="line">&quot;optimeDurable&quot; : &#123;</span><br><span class="line">&quot;ts&quot; : Timestamp(1700885131, 1),</span><br><span class="line">&quot;t&quot; : NumberLong(2)</span><br><span class="line">&#125;,</span><br><span class="line">&quot;optimeDate&quot; : ISODate(&quot;2023-11-25T04:05:31Z&quot;),</span><br><span class="line">&quot;optimeDurableDate&quot; : ISODate(&quot;2023-11-25T04:05:31Z&quot;),</span><br><span class="line">&quot;lastHeartbeat&quot; : ISODate(&quot;2023-11-25T04:05:36.128Z&quot;),</span><br><span class="line">&quot;lastHeartbeatRecv&quot; : ISODate(&quot;2023-11-25T04:05:36.404Z&quot;),</span><br><span class="line">&quot;pingMs&quot; : NumberLong(0),</span><br><span class="line">&quot;lastHeartbeatMessage&quot; : &quot;&quot;,</span><br><span class="line">&quot;syncingTo&quot; : &quot;127.0.0.1:24017&quot;,</span><br><span class="line">&quot;syncSourceHost&quot; : &quot;127.0.0.1:24017&quot;,</span><br><span class="line">&quot;syncSourceId&quot; : 0,</span><br><span class="line">&quot;infoMessage&quot; : &quot;&quot;,</span><br><span class="line">&quot;configVersion&quot; : 1</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;_id&quot; : 2,</span><br><span class="line">&quot;name&quot; : &quot;127.0.0.1:25017&quot;,</span><br><span class="line">&quot;health&quot; : 1,</span><br><span class="line">&quot;state&quot; : 2,</span><br><span class="line">&quot;stateStr&quot; : &quot;SECONDARY&quot;,</span><br><span class="line">&quot;uptime&quot; : 127,</span><br><span class="line">&quot;optime&quot; : &#123;</span><br><span class="line">&quot;ts&quot; : Timestamp(1700885131, 1),</span><br><span class="line">&quot;t&quot; : NumberLong(2)</span><br><span class="line">&#125;,</span><br><span class="line">&quot;optimeDurable&quot; : &#123;</span><br><span class="line">&quot;ts&quot; : Timestamp(1700885131, 1),</span><br><span class="line">&quot;t&quot; : NumberLong(2)</span><br><span class="line">&#125;,</span><br><span class="line">&quot;optimeDate&quot; : ISODate(&quot;2023-11-25T04:05:31Z&quot;),</span><br><span class="line">&quot;optimeDurableDate&quot; : ISODate(&quot;2023-11-25T04:05:31Z&quot;),</span><br><span class="line">&quot;lastHeartbeat&quot; : ISODate(&quot;2023-11-25T04:05:36.122Z&quot;),</span><br><span class="line">&quot;lastHeartbeatRecv&quot; : ISODate(&quot;2023-11-25T04:05:36.483Z&quot;),</span><br><span class="line">&quot;pingMs&quot; : NumberLong(0),</span><br><span class="line">&quot;lastHeartbeatMessage&quot; : &quot;&quot;,</span><br><span class="line">&quot;syncingTo&quot; : &quot;127.0.0.1:24017&quot;,</span><br><span class="line">&quot;syncSourceHost&quot; : &quot;127.0.0.1:24017&quot;,</span><br><span class="line">&quot;syncSourceId&quot; : 0,</span><br><span class="line">&quot;infoMessage&quot; : &quot;&quot;,</span><br><span class="line">&quot;configVersion&quot; : 1</span><br><span class="line">&#125;</span><br><span class="line">],</span><br><span class="line">&quot;ok&quot; : 1,</span><br><span class="line">&quot;operationTime&quot; : Timestamp(1700885131, 1),</span><br><span class="line">&quot;$clusterTime&quot; : &#123;</span><br><span class="line">&quot;clusterTime&quot; : Timestamp(1700885131, 1),</span><br><span class="line">&quot;signature&quot; : &#123;</span><br><span class="line">&quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;),</span><br><span class="line">&quot;keyId&quot; : NumberLong(0)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">bye</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">生产环境</span></span><br><span class="line">/home/mongodb/mongodb_27017/bin/mongo 127.0.0.1:27017  &lt; /home/mongodb/mongo_status</span><br></pre></td></tr></table></figure><h2 id="7-连接集群"><a href="#7-连接集群" class="headerlink" title="7 连接集群"></a>7 连接集群</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">/home/mongodb/mongodb_24017/bin/mongo --port 24017</span><br><span class="line">rs.status()</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">数据库集合命令</span></span><br><span class="line">1.显示所有的数据库</span><br><span class="line">  show dbs(全称 show databases)</span><br><span class="line">2.（创建）切换到指定的数据库</span><br><span class="line">  use 数据库名</span><br><span class="line">3.显示当前所在的数据库</span><br><span class="line">  db</span><br><span class="line">4.删除当前数据库（先切换再删除）</span><br><span class="line">  use 库名</span><br><span class="line">  db.dropDatabase()</span><br><span class="line">5.创建集合</span><br><span class="line">  db.createCollection(&#x27;集合名称&#x27;)</span><br><span class="line">6.显示当前数据库中的所有集合</span><br><span class="line">  show collections</span><br><span class="line">7.删除某个集合</span><br><span class="line">  db.集合名.drop()</span><br><span class="line">8.重命名集合</span><br><span class="line">  db.集合名.renameCollection(&#x27;newName&#x27;)</span><br><span class="line">9.查询集合数据</span><br><span class="line">  db.consumer_crm_record.find()</span><br><span class="line">10.修改密码</span><br><span class="line">  use qms</span><br><span class="line">  db.changeUserPassword(&quot;qmsMongodb&quot;, &quot;qms@123&quot;)</span><br><span class="line">11.查看用户权限 </span><br><span class="line">  db.getUser(&quot;mongo_read&quot;)</span><br></pre></td></tr></table></figure><h2 id="8-创建用户"><a href="#8-创建用户" class="headerlink" title="8 创建用户"></a>8 创建用户</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试环境</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># admin 登录</span></span>  </span><br><span class="line">/home/mongodb/mongodb_27017/bin/mongo -u admin -p &quot;jwgod@123&quot; --host 192.168.1.26 --port 27017 --authenticationDatabase admin </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 创建jwgod  db</span></span></span><br><span class="line">use jwgod</span><br><span class="line">db.createUser(&#123;</span><br><span class="line">  user: &quot;jwgod&quot;,</span><br><span class="line">  pwd: &quot;jwgod@123&quot;,</span><br><span class="line">  roles: [&#123; role: &quot;readWrite&quot;, db: &quot;jwgod&quot; &#125;]</span><br><span class="line">&#125;)</span><br><span class="line">/home/mongodb/mongodb_27017/bin/mongo -u jwgod -p jwgod@123 --host 192.168.1.26 --port 27017 --authenticationDatabase jwgod</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 创建consumer  db</span></span></span><br><span class="line">use consumer</span><br><span class="line">db.createUser(&#123;</span><br><span class="line">  user: &quot;consumer&quot;,</span><br><span class="line">  pwd: &quot;consumer@123&quot;,</span><br><span class="line">  roles: [&#123; role: &quot;readWrite&quot;, db: &quot;consumer&quot; &#125;]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">/home/mongodb/mongodb_27017/bin/mongo -u consumer -p consumer@123 --host 192.168.1.26 --port 27017 --authenticationDatabase consumer</span><br></pre></td></tr></table></figure><h2 id="9-mongodb备份恢复"><a href="#9-mongodb备份恢复" class="headerlink" title="9 mongodb备份恢复"></a>9 mongodb备份恢复</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">备份所有库</span></span><br><span class="line">/home/mongodb/mongodb_27017/bin/mongodump  -u admin -p &quot;jwgod@123&quot; --host 192.168.1.26 --port 27017 --gzip --out /home/bak_mongodb/mongo-20231204</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">备份个数据库</span></span><br><span class="line">/home/mongodb/mongodb_24017/bin/mongodump -u admin -p &quot;jwgod@123&quot; --host 192.168.1.26 --authenticationDatabase admin  --port 24017 --db jwgod --out /home/bak_mongodb/jwgod-20231205</span><br><span class="line"></span><br><span class="line">–db 数据库名</span><br><span class="line">–out 备份文件输出文件夹</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">备份单个表</span></span><br><span class="line">/home/mongodb/mongodb_27017/bin/mongodump -u admin -p &quot;jwgod@123&quot; --host 192.168.1.26 --port 27017 -d mydb -o /var/backups/mongo --collection users</span><br><span class="line">-d 数据库</span><br><span class="line">-o 备份文件输出路径</span><br><span class="line">–collection 指定的备份表</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mongorestore的使用</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">恢复所有数据库</span></span><br><span class="line">/home/mongodb/mongodb_27017/bin/mongorestore -u admin -p &quot;jwgod@123&quot; --host 192.168.1.26 --port 27017 --username root2 --password 123456    /data/backup/mongodb_all_backup/mongo</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">恢复单个数据库qms</span></span><br><span class="line">/home/mongodb/mongodb_27017/bin/mongorestore -u admin -p &quot;jwgod@123&quot; --host 192.168.1.26  --port 27017 --authenticationDatabase admin --db jwgod /home/bak_mongodb/jwgod-20231205/qms</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">恢复单个数据库consumer</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">gunzip consumer_crm_record.bson.gz</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">gunzip consumer_crm_record.metadata.json.gz</span></span><br><span class="line">/home/mongodb/mongodb_27017/bin/mongorestore -u admin -p &quot;jwgod@123&quot; --host 192.168.1.26  --port 27017 --authenticationDatabase admin --db consumer /home/mongodb/mongodb_all_backup-202312260000/consumer</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mongodb </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>歌单分享</title>
      <link href="/posts/3777670968.html"/>
      <url>/posts/3777670968.html</url>
      
        <content type="html"><![CDATA[<h1 id="好听歌单："><a href="#好听歌单：" class="headerlink" title="好听歌单："></a>好听歌单：</h1><h2 id="0001-冬天的秘密-周传雄"><a href="#0001-冬天的秘密-周传雄" class="headerlink" title="0001 冬天的秘密-周传雄"></a>0001 冬天的秘密-周传雄</h2><iframe     frameborder="no"     border="0"     marginwidth="0"     marginheight="0"     width=330     height=86     src="//music.163.com/outchain/player?type=2&id=189545&auto=1&height=66"></iframe><h2 id="0002-悟空-戴荃"><a href="#0002-悟空-戴荃" class="headerlink" title="0002 悟空-戴荃"></a>0002 悟空-戴荃</h2><iframe     frameborder="no"     border="0"     marginwidth="0"     marginheight="0"     width=330     height=86     src="//music.163.com/outchain/player?type=2&id=33162226&auto=1&height=66"></iframe><h2 id="0003-大鱼-周深"><a href="#0003-大鱼-周深" class="headerlink" title="0003 大鱼-周深"></a>0003 大鱼-周深</h2><iframe     frameborder="no"     border="0"     marginwidth="0"     marginheight="0"     width=330     height=86     src="//music.163.com/outchain/player?type=2&id=416385506&auto=1&height=66"></iframe>]]></content>
      
      
      <categories>
          
          <category> 音乐 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Music </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>check_list_port</title>
      <link href="/posts/2897752293.html"/>
      <url>/posts/2897752293.html</url>
      
        <content type="html"><![CDATA[<h1 id="checkout-listen-port"><a href="#checkout-listen-port" class="headerlink" title="checkout listen port"></a>checkout listen port</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># @Date    : 2023-06-16</span></span><br><span class="line"><span class="comment"># @Author  : jwgod</span></span><br><span class="line"><span class="comment"># @Version : 1.0.0</span></span><br><span class="line"><span class="comment"># 检测本机指定端口是否还在监听</span></span><br><span class="line"><span class="comment"># 运行：check_listen_port.py -p 8080</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> mail163</span><br><span class="line"><span class="keyword">import</span> local_ip <span class="keyword">as</span> lip</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_listen_port</span>(<span class="params">port</span>):</span><br><span class="line">    ip = lip.get_IP()</span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    r = s.connect_ex((<span class="string">&#x27;127.0.0.1&#x27;</span>, port))</span><br><span class="line">    <span class="keyword">if</span> r != <span class="number">0</span>:</span><br><span class="line">        <span class="comment"># print(&#x27;%s port %s is down&#x27; % (ip, str(port)))</span></span><br><span class="line">        mail163.mail(<span class="string">&#x27;jwgod@163.com&#x27;</span>, <span class="string">&#x27;mail_aler&#x27;</span>, <span class="string">&#x27;%s port %s is down&#x27;</span> % (ip, <span class="built_in">str</span>(port)))</span><br><span class="line">    s.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_args</span>():</span><br><span class="line">    p = argparse.ArgumentParser()</span><br><span class="line">    p.add_argument(<span class="string">&#x27;-p&#x27;</span>, <span class="string">&#x27;--port&#x27;</span>, nargs=<span class="string">&#x27;+&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, <span class="built_in">help</span>=<span class="string">&#x27;本机监听的端口号&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> p.parse_args()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    args = add_args()</span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> args.port:</span><br><span class="line">        check_listen_port(p)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="local-ip"><a href="#local-ip" class="headerlink" title="local ip"></a>local ip</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># @Date    : 2023-06-16</span></span><br><span class="line"><span class="comment"># @Author  : jwgod</span></span><br><span class="line"><span class="comment"># @Version : 1.0.0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">r_ip = <span class="string">&#x27;192.168.64.129&#x27;</span>  <span class="comment"># 没有公网IP，先用内网网关对付</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_IP</span>():</span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br><span class="line">    s.connect((r_ip, <span class="number">0</span>))</span><br><span class="line">    ip = s.getsockname()[<span class="number">0</span>]</span><br><span class="line">    s.close()</span><br><span class="line">    <span class="keyword">return</span> ip</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    ip=get_IP()</span><br><span class="line">    <span class="built_in">print</span>(ip)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="mail163"><a href="#mail163" class="headerlink" title="mail163"></a>mail163</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># python mail.py jwgod@163.com mail_aler xxxx-is-down</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> smtplib</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> email.mime.text <span class="keyword">import</span> MIMEText</span><br><span class="line"><span class="keyword">from</span> email.header <span class="keyword">import</span> Header</span><br><span class="line"></span><br><span class="line">smtp_server = <span class="string">&#x27;smtphz.qiye.163.com&#x27;</span></span><br><span class="line">mail_user = <span class="string">&#x27;jwgod@163.com&#x27;</span></span><br><span class="line">password = <span class="string">&#x27;xxxxxxxxx&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mail</span>(<span class="params">to, subject, txt</span>):</span><br><span class="line">    msg = MIMEText(txt, <span class="string">&#x27;html&#x27;</span>, _charset=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    msg[<span class="string">&#x27;From&#x27;</span>] = mail_user</span><br><span class="line">    msg[<span class="string">&#x27;To&#x27;</span>] = to</span><br><span class="line">    msg[<span class="string">&#x27;Subject&#x27;</span>] = Header(subject, <span class="string">&#x27;utf-8&#x27;</span>).encode()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        s = smtplib.SMTP_SSL(smtp_server, port=<span class="number">465</span>)</span><br><span class="line">        s.login(mail_user, password)</span><br><span class="line">        s.sendmail(mail_user, to, msg.as_string())</span><br><span class="line">        s.quit()</span><br><span class="line">    <span class="keyword">except</span> smtplib.SMTPException <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Error: %s&quot;</span> % e)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) != <span class="number">4</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;$1 to_user $2 Subject $3 Content&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">len</span>(sys.argv))</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        mail(sys.argv[<span class="number">1</span>], sys.argv[<span class="number">2</span>], sys.argv[<span class="number">3</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 脚本 </category>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> 端口检查 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rocky linux</title>
      <link href="/posts/2847517668.html"/>
      <url>/posts/2847517668.html</url>
      
        <content type="html"><![CDATA[<h1 id="1-Rocky-linux"><a href="#1-Rocky-linux" class="headerlink" title="1. Rocky linux"></a>1. Rocky linux</h1><h2 id="1-1-安装时分区"><a href="#1-1-安装时分区" class="headerlink" title="1.1 安装时分区"></a>1.1 安装时分区</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">创建以下分区</span><br><span class="line"></span><br><span class="line">/boot: 2GB</span><br><span class="line">/ :21GB</span><br><span class="line">swap: 2GB</span><br><span class="line"></span><br><span class="line">/home: 25GB</span><br><span class="line"></span><br><span class="line">创建第一个分区，大小为2GB的 /boot 分区，点击添加挂载点（Add mount point）</span><br></pre></td></tr></table></figure><h2 id="1-2-配置网络"><a href="#1-2-配置网络" class="headerlink" title="1.2 配置网络"></a>1.2 配置网络</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">vi /etc/NetworkManager/system-connections/ens160.nmconnection</span></span><br><span class="line">[connection]</span><br><span class="line">id=ens160</span><br><span class="line">uuid=466abc28-0ac4-3774-a6a1-16a4d9ba1051</span><br><span class="line">type=ethernet</span><br><span class="line">autoconnect-priority=-999</span><br><span class="line">interface-name=ens160</span><br><span class="line">timestamp=1686755143</span><br><span class="line"></span><br><span class="line">[ethernet]</span><br><span class="line"></span><br><span class="line">[ipv4]</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">method=auto</span></span><br><span class="line">method=manual</span><br><span class="line">address=192.168.64.56/24,192.168.64.2</span><br><span class="line">dns=114.114.114.114</span><br><span class="line"></span><br><span class="line">[ipv6]</span><br><span class="line">addr-gen-mode=eui64</span><br><span class="line">method=auto</span><br><span class="line"></span><br><span class="line">[proxy]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">nmcli c reload</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">nmcli c up ens160</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">另一种方法：</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ssh root@192.168.1.76 <span class="string">&quot;nmcli con mod ens18 ipv4.addresses 192.168.1.30/24; nmcli con mod ens18 ipv4.gateway 192.168.1.99; nmcli con mod ens18 ipv4.method manual; nmcli con mod ens18 ipv4.dns &quot;</span>8.8.8.8<span class="string">&quot;; nmcli con up ens18&quot;</span></span></span><br></pre></td></tr></table></figure><h2 id="1-3-系统时间设定"><a href="#1-3-系统时间设定" class="headerlink" title="1.3 系统时间设定"></a>1.3 系统时间设定</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">tzselect</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">依次输入4、10、1、1</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">timedatectl list-timezones |grep Asia/Shanghai</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">timedatectl set-timezone Asia/Shanghai</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">timedatectl</span></span><br></pre></td></tr></table></figure><h2 id="1-4-SELinux配置"><a href="#1-4-SELinux配置" class="headerlink" title="1.4 SELinux配置"></a>1.4 SELinux配置</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">禁用SELinux</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">setenforce 0</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">sed -i <span class="string">&quot;s/SELINUX=enforcing/SELINUX=disabled/g&quot;</span> /etc/selinux/config</span></span><br><span class="line">sed &#x27;/Hello/s/$/!/&#x27;</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">内核层禁用</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">grubby --update-kernel ALL --args selinux=0</span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看是否禁用</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">grubby --info DEFAULT</span></span><br><span class="line">index=0</span><br><span class="line">kernel=&quot;/boot/vmlinuz-5.14.0-70.13.1.el9_0.x86_64&quot;</span><br><span class="line">args=&quot;ro crashkernel=1G-4G:192M,4G-64G:256M,64G-:512M resume=/dev/mapper/rl-swap rd.lvm.lv=rl/root rd.lvm.lv=rl/swap selinux=0&quot;</span><br><span class="line">root=&quot;/dev/mapper/rl-root&quot;</span><br><span class="line">initrd=&quot;/boot/initramfs-5.14.0-70.13.1.el9_0.x86_64.img&quot;</span><br><span class="line">title=&quot;Rocky Linux (5.14.0-70.13.1.el9_0.x86_64) 9.0 (Blue Onyx)&quot;</span><br><span class="line">id=&quot;0af0a3c0bc4946a6bb4cc8daa8c8a1f7-5.14.0-70.13.1.el9_0.x86_64&quot;</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">回滚内核层禁用操作</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">grubby --update-kernel ALL --remove-args selinux</span></span><br></pre></td></tr></table></figure><h2 id="1-5-防火墙配置"><a href="#1-5-防火墙配置" class="headerlink" title="1.5 防火墙配置"></a>1.5 防火墙配置</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动防火墙</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">systemctl start firewalld</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">停止防火墙</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">systemctl stop firewalld</span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">禁用防火墙</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">systemctl <span class="built_in">disable</span> firewalld</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启用防火墙</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">systemctl <span class="built_in">enable</span> firewalld</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">systemctl status firewalld</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">firewall-cmd --reload</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">firewall-cmd --list-all</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">firewall-cmd --state</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">firewall-cmd --zone=public --add-port=8888/tcp --permanent</span></span><br><span class="line">firewall-cmd --zone=public --add-port=9121/tcp --permanent</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">firewall-cmd --zone=public --remove-port=80/tcp --permanent</span> </span><br></pre></td></tr></table></figure><h2 id="1-6-镜像源"><a href="#1-6-镜像源" class="headerlink" title="1.6 镜像源"></a>1.6 镜像源</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">更换镜像源</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">sed -e <span class="string">&#x27;s|^mirrorlist=|#mirrorlist=|g&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">    -e <span class="string">&#x27;s|^#baseurl=http://dl.rockylinux.org/$contentdir|baseurl=https://mirrors.aliyun.com/rockylinux|g&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">    -i.bak \</span></span><br><span class="line"><span class="language-bash">    /etc/yum.repos.d/rocky-*.repo</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">更新镜像源</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">dnf clean all</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">dnf autoremove</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">rm</span> -rf /var/cache/yum</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">dnf makecache</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">dnf repolist</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">dnf update</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装依赖</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">dnf install wget make gcc bzip2-devel openssl-devel zlib-devel libffi-devel telnet curl net-tools htop lrzsz zip unzip vim -y</span> </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># dnf -y install pcre pcre-devel openssl openssl-devel gcc-c++ autoconf automake zlib-devel libxml2 libxml2-dev  libxslt-devel gd-devel perl-devel perl-ExtUtils-Embed GeoIP GeoIP-devel GeoIP-data</span></span></span><br></pre></td></tr></table></figure><h2 id="1-7-设置时间同步"><a href="#1-7-设置时间同步" class="headerlink" title="1.7 设置时间同步"></a>1.7 设置时间同步</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">Rocky Linux默认已安装chrony服务，如果没有安装的话，使用dnf命令进行安装。</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">rpm -qa | grep chrony命令确认chrony是否安装</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装chrony</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">dnf install chrony</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改配置文件如下</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">vim /etc/chrony.conf</span></span><br><span class="line">pool ntp.aliyun.com iburst</span><br><span class="line">pool ntp1.aliyun.com iburst</span><br><span class="line">server 0.centos.pool.ntp.org iburst</span><br><span class="line">server 1.centos.pool.ntp.org iburst</span><br><span class="line">server 2.centos.pool.ntp.org iburst</span><br><span class="line">server 3.centos.pool.ntp.org iburst</span><br><span class="line"></span><br><span class="line">driftfile /var/lib/chrony/drift</span><br><span class="line">makestep 1.0 3</span><br><span class="line">rtcsync</span><br><span class="line">keyfile /etc/chrony.keys</span><br><span class="line">leapsectz right/UTC</span><br><span class="line">allow 192.168.129.0/24</span><br><span class="line">logdir /var/log/chrony</span><br><span class="line">leapsecmode slew</span><br><span class="line">maxslewrate 1000</span><br><span class="line">smoothtime 400 0.001024 leaponly</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">systemctl restart chronyd</span> </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">systemctl <span class="built_in">enable</span> chronyd</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">chronyc sources -v</span></span><br><span class="line">- 立即手工同步　</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">chronyc -a makestep</span></span><br><span class="line">- 将当前时间和日期写入BIOS，避免重启后失效</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">hwclock -w</span></span><br></pre></td></tr></table></figure><h2 id="1-8-关闭交换分区"><a href="#1-8-关闭交换分区" class="headerlink" title="1.8 关闭交换分区"></a>1.8 关闭交换分区</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed -ri &#x27;s/.*swap.*/#&amp;/&#x27; /etc/fstab</span><br><span class="line">swapoff -a &amp;&amp; sysctl -w vm.swappiness=0\</span><br><span class="line"></span><br><span class="line">cat /etc/fstab</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/dev/mapper/centos-swap swap                    swap    defaults        0 0</span></span><br></pre></td></tr></table></figure><h2 id="1-9-配置ulimit"><a href="#1-9-配置ulimit" class="headerlink" title="1.9 配置ulimit"></a>1.9 配置ulimit</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ulimit -SHn 65535</span><br><span class="line">cat &gt;&gt; /etc/security/limits.conf &lt;&lt;EOF</span><br><span class="line">* soft nofile 655360</span><br><span class="line">* hard nofile 131072</span><br><span class="line">* soft nproc 655350</span><br><span class="line">* hard nproc 655350</span><br><span class="line">* seft memlock unlimited</span><br><span class="line">* hard memlock unlimitedd</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h2 id="1-10-crontab-e"><a href="#1-10-crontab-e" class="headerlink" title="1.10 crontab -e"></a>1.10 crontab -e</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">crontab: installing new crontab   &quot;/tmp/crontab.Asj6b6&quot;:1: bad minute    errors in crontab file, can&#x27;t install</span><br><span class="line"></span><br><span class="line">*/10 * * * * /usr/local/bin/python3 /home/check_listen/check_listen_port.py -p 8080 80 &gt; /home/check_listen/check_listen_port.log 2&gt;&amp;1</span><br><span class="line">*/10 * * * * /usr/local/bin/python3 /home/check_listen/check_listen_port.py -p 3306 &gt; /home/check_listen/check_listen_port.log 2&gt;&amp;1</span><br><span class="line">00 00 * * * sh /home/mysql_bak/mysql_9_bak-v1.sh &gt; /home/mysql_bak/mysql_9_bak-v1.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure><h2 id="1-11-修改hostname"><a href="#1-11-修改hostname" class="headerlink" title="1.11 修改hostname"></a>1.11 修改hostname</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># /etc/hostname</span><br><span class="line"># hostnamectl set-hostname V002012005_master_01_35</span><br><span class="line"></span><br><span class="line"># pro</span><br><span class="line">hostnamectl set-hostname V002012016_k8s_master1_pro_51</span><br><span class="line">Hsyk@56789</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> 操作系统 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>git-flows</title>
      <link href="/posts/1069623423.html"/>
      <url>/posts/1069623423.html</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="1-分支类别"><a href="#1-分支类别" class="headerlink" title="1.分支类别"></a>1.分支类别</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.Main   主分支</span><br><span class="line">2.Develop  开发分支</span><br><span class="line">3.feature  功能分支(临时分支)</span><br><span class="line">4.release  预发布分支(临时分支)</span><br><span class="line">5.fixbug   修复bug分支(临时分支)</span><br></pre></td></tr></table></figure><h1 id="2-分支作用"><a href="#2-分支作用" class="headerlink" title="2.分支作用"></a>2.分支作用</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1.Main 主分支作用</span><br><span class="line">代码库有且仅有一个主分支，所有提供给用户使用的正式版本，都在这个主分支上发布，主分支只用来分布重大版本，每次重大发布打tag标记。</span><br><span class="line"></span><br><span class="line">2.Develop 开发分支</span><br><span class="line">日常开发分支，我们把开发用的分支，叫做Develop。这个分支可以用来生成代码的最新隔夜版本（nightly）。如果想正式对外发布，就在Main分支上，对Develop分支进行&quot;合并&quot;（merge）</span><br><span class="line"></span><br><span class="line">3.feature  功能分支(临时分支)</span><br><span class="line">临时分支 使用完以后，应该删除，使得代码库的常设分支始终只有Main和Develop。它是为了开发某种特定功能，从Develop分支上面分出来的。开发完成后，要再并入Develop。功能分支的名字，可以采用feature-name-time的形式命名，例如：feature-bright-230612。</span><br><span class="line"></span><br><span class="line">4.release  预发布分支(临时分支)</span><br><span class="line">它是指发布正式版本之前（即合并到Main分支之前），我们可能需要有一个预发布的版本进行测试。预发布分支是从Develop分支上面分出来的，预发布结束以后，必须合并进Develop和Main分支。它的命名，可以采用release-name-time的形式。</span><br><span class="line"></span><br><span class="line">5.fixbug   修复bug分支(临时分支)</span><br><span class="line">修补bug分支是从Main分支上面分出来的，修补结束以后，再合并进Main和Develop分支。它的命名，可以采用fixbug-name-time的形式 如：fixbug-bright-230612</span><br></pre></td></tr></table></figure><h1 id="3-合并分支"><a href="#3-合并分支" class="headerlink" title="3.合并分支"></a>3.合并分支</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- 查看当前处于哪个分支:</span><br><span class="line">  git branch -a</span><br><span class="line">- Git创建Develop分支的命令：</span><br><span class="line">  git checkout -b develop Main</span><br><span class="line"></span><br><span class="line">- 将Develop分支发布到Main分支的命令：</span><br><span class="line">  1.切换到Main分支:</span><br><span class="line">    git checkout Main</span><br><span class="line">  2.对Develop分支进行合并:</span><br><span class="line">    git merge --no-ff develop</span><br><span class="line">  解释：默认情况下，Git执行&quot;快进式合并&quot;（fast-farward merge）会直接将Main分支指向Develop分支。使用--no-ff参数后，会执行正常合并，在Main分支上生成一个新节点。为了保证版本演进的清晰，我们希望采用这种做法。</span><br></pre></td></tr></table></figure><h1 id="4-功能分支-临时分支"><a href="#4-功能分支-临时分支" class="headerlink" title="4.功能分支(临时分支)"></a>4.功能分支(临时分支)</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">示例：</span><br><span class="line">- 创建一份新的分支:</span><br><span class="line">  git checkout -b feature-kefu-230612 develop</span><br><span class="line">- 合并到开发分支:</span><br><span class="line">  git checkout develop</span><br><span class="line">  git merge --no-ff feature-kefu-230612</span><br><span class="line"></span><br><span class="line">- 删除已合并分支:</span><br><span class="line">  git branch -d feature-kefu-230612</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="5-预发布分支-临时分支"><a href="#5-预发布分支-临时分支" class="headerlink" title="5.预发布分支(临时分支)"></a>5.预发布分支(临时分支)</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">- 创建预发布分支:</span><br><span class="line">  git checkout -b release-kefu-150215 develop</span><br><span class="line">- 确认无问题后 合并到Main分支</span><br><span class="line">  git checkout Main</span><br><span class="line">  git merge --no-ff release-kefu-150215</span><br><span class="line"></span><br><span class="line">- 对合并生成的新节点，做一个标签</span><br><span class="line">  git tag -a v1.1</span><br><span class="line"></span><br><span class="line">- 再合并到开发分支</span><br><span class="line">  git checkout develop</span><br><span class="line">  git merge --no-ff release-kefu-150215</span><br><span class="line"></span><br><span class="line">- 删除分支:</span><br><span class="line">  git branch -d release-kefu-150215</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="6-修复bug分支-临时分支"><a href="#6-修复bug分支-临时分支" class="headerlink" title="6.修复bug分支(临时分支)"></a>6.修复bug分支(临时分支)</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- 创建一个修补bug分支：</span><br><span class="line">  git checkout -b fixbug-kefu-230612 Main</span><br><span class="line">  </span><br><span class="line">- 修补结束后，合并到Main分支：</span><br><span class="line">  git checkout Main</span><br><span class="line">  git merge --no-ff fixbug-kefu-230612</span><br><span class="line">  git tag -a v1.2_3</span><br><span class="line"></span><br><span class="line">- 再合并到develop分支：</span><br><span class="line">  git checkout develop</span><br><span class="line">  git merge --no-ff fixbug-kefu-230612</span><br><span class="line"></span><br><span class="line">- 最后，删除&quot;修补bug分支&quot;：</span><br><span class="line">  git branch -d fixbug-kefu-230612</span><br></pre></td></tr></table></figure><h1 id="7-其它git操作"><a href="#7-其它git操作" class="headerlink" title="7.其它git操作"></a>7.其它git操作</h1><h2 id="7-1-test分支版本回退"><a href="#7-1-test分支版本回退" class="headerlink" title="7.1 test分支版本回退"></a>7.1 test分支版本回退</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git log</span><br><span class="line">git reset --hard id  //选择要回退的id</span><br><span class="line">git push -f origin test  //回退后强制推送到远程仓库</span><br></pre></td></tr></table></figure><h2 id="7-2-git拉取远程分支"><a href="#7-2-git拉取远程分支" class="headerlink" title="7.2 git拉取远程分支"></a>7.2 git拉取远程分支</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git fetch origin dev //从远程获取最新版本到本地，不会自动merge</span><br><span class="line">git checkout -b 本地分支名 origin/远程分支名  </span><br></pre></td></tr></table></figure><h2 id="7-3-拉取远程分支到本地分支"><a href="#7-3-拉取远程分支到本地分支" class="headerlink" title="7.3 拉取远程分支到本地分支"></a>7.3 拉取远程分支到本地分支</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git checkout mydev  //切换到本地分支</span><br><span class="line">git pull origin dev   //将远程仓库中的dev分支拉取到mydev分支</span><br></pre></td></tr></table></figure><h2 id="7-4-删除本地分支及远程分支"><a href="#7-4-删除本地分支及远程分支" class="headerlink" title="7.4 删除本地分支及远程分支"></a>7.4 删除本地分支及远程分支</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git branch -D dev  //删除本地分支</span><br><span class="line">git push origin :dev  //删除远程分支s</span><br></pre></td></tr></table></figure><h2 id="7-5-删除本地及远程仓库tag"><a href="#7-5-删除本地及远程仓库tag" class="headerlink" title="7.5 删除本地及远程仓库tag"></a>7.5 删除本地及远程仓库tag</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git tag -d v2.9.0　　　　　　　　//本地删除tag</span><br><span class="line">git push origin :refs/tags/v2.9.0　　　　　//本地tag删除了，再执行该句，删除线上tag</span><br></pre></td></tr></table></figure><h2 id="7-6-查看最近3条更新日志，并简单显示出所涉及的文件"><a href="#7-6-查看最近3条更新日志，并简单显示出所涉及的文件" class="headerlink" title="7.6 查看最近3条更新日志，并简单显示出所涉及的文件"></a>7.6 查看最近3条更新日志，并简单显示出所涉及的文件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git log -3 --stat</span><br><span class="line">git show 3dbfdbccc8238ff688316e481266cfbda8733b8d   //查看修改了文件的那些内容</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>1990-1999年十首金曲分享</title>
      <link href="/posts/3348715242.html"/>
      <url>/posts/3348715242.html</url>
      
        <content type="html"><![CDATA[<div style="position: relative; padding-bottom: 56.25%; height: 0;">  <video src="https://jwgod-blog.oss-cn-beijing.aliyuncs.com/video/%E9%9F%B3%E8%A7%86%E9%A2%91/1990-1999-jwgod_x264.mp4" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;" controls>    Your browser does not support the video tag.  </video></div>]]></content>
      
      
      <categories>
          
          <category> 视频 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Videos </tag>
            
            <tag> Movie </tag>
            
            <tag> Music </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>minio K8S 部署</title>
      <link href="/posts/2321188352.html"/>
      <url>/posts/2321188352.html</url>
      
        <content type="html"><![CDATA[<h1 id="yaml部署方式"><a href="#yaml部署方式" class="headerlink" title="yaml部署方式"></a>yaml部署方式</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">minio-statefulset.yaml</span></span><br><span class="line">---</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: StatefulSet</span><br><span class="line">metadata:</span><br><span class="line">  name: minio</span><br><span class="line">  namespace: minio</span><br><span class="line">spec:</span><br><span class="line">  serviceName: minio</span><br><span class="line">  replicas: 4</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: minio</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: minio</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: minio</span><br><span class="line">        env:</span><br><span class="line">        - name: MINIO_ROOT_USER</span><br><span class="line">          value: &quot;admin&quot;</span><br><span class="line">        - name: MINIO_ROOT_PASSWORD</span><br><span class="line">          value: &quot;root123456&quot;</span><br><span class="line">        image: 192.168.129.33:5000/minio/minio:latest</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        command:</span><br><span class="line">          - /bin/sh</span><br><span class="line">          - -c</span><br><span class="line">          - minio server --console-address &quot;:9001&quot; http://minio-&#123;0...3&#125;.minio.minio.svc.cluster.local/data</span><br><span class="line">        ports:</span><br><span class="line">        - name: data</span><br><span class="line">          containerPort: 9000</span><br><span class="line">          protocol: &quot;TCP&quot;</span><br><span class="line">        - name: console</span><br><span class="line">          containerPort: 9001</span><br><span class="line">          protocol: &quot;TCP&quot;</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: minio-data</span><br><span class="line">          mountPath: /data</span><br><span class="line">        - name: date-config</span><br><span class="line">          mountPath: /etc/localtime</span><br><span class="line">      volumes:</span><br><span class="line">        - name: date-config</span><br><span class="line">          hostPath:</span><br><span class="line">            path: /usr/share/zoneinfo/Asia/Shanghai</span><br><span class="line">  volumeClaimTemplates:</span><br><span class="line">  - metadata:</span><br><span class="line">      name: minio-data</span><br><span class="line">    spec:</span><br><span class="line">      accessModes:</span><br><span class="line">        - ReadWriteMany</span><br><span class="line">      resources:</span><br><span class="line">        requests:</span><br><span class="line">          storage: 10Gi</span><br><span class="line">      storageClassName: managed-nfs-storage</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: minio</span><br><span class="line">  namespace: minio</span><br><span class="line">  labels:</span><br><span class="line">    app: minio</span><br><span class="line">spec:</span><br><span class="line">  clusterIP: None</span><br><span class="line">  ports:</span><br><span class="line">    - port: 9000</span><br><span class="line">      name: data</span><br><span class="line">    - port: 9001</span><br><span class="line">      name: console</span><br><span class="line">  selector:</span><br><span class="line">    app: minio</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: minio-service-svc</span><br><span class="line">  namespace: minio</span><br><span class="line">spec:</span><br><span class="line">  type: NodePort</span><br><span class="line">  ports:</span><br><span class="line">   - name: data</span><br><span class="line">     port: 9000</span><br><span class="line">     targetPort: 9000</span><br><span class="line">     protocol: TCP</span><br><span class="line">     nodePort: 30025 </span><br><span class="line">   - name: console</span><br><span class="line">     port: 9001</span><br><span class="line">     targetPort: 9001</span><br><span class="line">     protocol: TCP</span><br><span class="line">     nodePort: 30023</span><br><span class="line">  selector:</span><br><span class="line">    app: minio</span><br></pre></td></tr></table></figure><h1 id="利用-mc迁移minio数据"><a href="#利用-mc迁移minio数据" class="headerlink" title="利用 mc迁移minio数据"></a>利用 mc迁移minio数据</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">参考文档：http://wiki.sqlfans.cn/minio/minio-migr-mc.html</span></span><br><span class="line"></span><br><span class="line">源头minio节点：https://minio.xxxxx.com  </span><br><span class="line">  user：syncer</span><br><span class="line">  password：xxxxxx</span><br><span class="line">  bucket：test-public、test-private</span><br><span class="line">目标minio节点：https://oss.xxxx.com</span><br><span class="line">  user：admin</span><br><span class="line">  password：xxxxxx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1.源节点：下载最新版的 mc客户端</span></span><br><span class="line">curl -sL https://dl.min.io/client/mc/release/linux-amd64/mc -o /usr/bin/mc</span><br><span class="line">chmod +x /usr/bin/mc</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2.源节点：针对2个minio节点，创建2个别名</span></span><br><span class="line">mc alias set minio1 https://minio.xxxx.com syncer xxxx --api s3v4</span><br><span class="line">mc alias set minio2 https://oss.xxxx.com admin xxxx --api s3v4</span><br><span class="line">mc alias list</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3.源节点：模拟源节点（minio1）某bucket已存在文件，示例 bucket111</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">mc mb minio1/test-public</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">mc <span class="built_in">cp</span> /etc/hosts minio1/test-public</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">mc <span class="built_in">cp</span> /etc/sysconfig minio1/test-public --recursive</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">4.源节点：为目标节点（minio2）创建bucket，并利用<span class="built_in">cp</span>命令实现一次数据同步</span></span><br><span class="line">mc mb minio2/test-public</span><br><span class="line">mc mb minio2/test-private</span><br><span class="line">mc cp --recursive minio1/test-public minio2</span><br><span class="line">mc cp --recursive minio1/test-private minio2</span><br></pre></td></tr></table></figure><h1 id="minio授权用户及创建bucket"><a href="#minio授权用户及创建bucket" class="headerlink" title="minio授权用户及创建bucket"></a>minio授权用户及创建bucket</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">bucket要求：</span></span><br><span class="line">sams-private：Anonymous Access为默认</span><br><span class="line">sams-public：Anonymous Access为&#123;&quot;Prefix&quot;: &quot;*&quot;, &quot;Access&quot;: &quot;readonly&quot;&#125;</span><br><span class="line"></span><br><span class="line">1. 创建账号密码</span><br><span class="line">    shaixxx    xxx@P2023    # 生产环境，readwrite, Secret Key</span><br><span class="line">2. Policies--&gt;readwrite--&gt;Raw Policy</span><br><span class="line">&#123;</span><br><span class="line">    &quot;Version&quot;: &quot;2012-10-17&quot;,</span><br><span class="line">    &quot;Statement&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Effect&quot;: &quot;Allow&quot;,</span><br><span class="line">            &quot;Action&quot;: [</span><br><span class="line">                &quot;s3:DeleteObject&quot;,</span><br><span class="line">                &quot;s3:GetBucketLocation&quot;,</span><br><span class="line">                &quot;s3:GetObject&quot;,</span><br><span class="line">                &quot;s3:PutObject&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Resource&quot;: [</span><br><span class="line">                &quot;arn:aws:s3:::sams-*&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">3. 访问</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">mc <span class="built_in">alias</span> <span class="built_in">set</span> shancha https://oss.xxxx.com shaicha xxxx@P2023 --api s3v4</span></span><br><span class="line">Added `shancha` successfully.</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">mc <span class="built_in">alias</span> list</span></span><br><span class="line">shancha</span><br><span class="line">  URL       : https://oss.xxxx.com</span><br><span class="line">  AccessKey : shaicha</span><br><span class="line">  SecretKey : xxxx@P2023</span><br><span class="line">  API       : s3v4</span><br><span class="line">  Path      : auto</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 容器 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 文件存储 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>markdown基本语法</title>
      <link href="/posts/1204465438.html"/>
      <url>/posts/1204465438.html</url>
      
        <content type="html"><![CDATA[<h2 id="标题"><a href="#标题" class="headerlink" title="标题:"></a>标题:</h2><ul><li><h1 id="一级标题"><a href="#一级标题" class="headerlink" title="一级标题"></a>一级标题</h1></li><li><h2 id="二级标题"><a href="#二级标题" class="headerlink" title="二级标题"></a>二级标题</h2></li><li><h3 id="三级标题"><a href="#三级标题" class="headerlink" title="三级标题"></a>三级标题</h3></li><li><h4 id="四级标题"><a href="#四级标题" class="headerlink" title="四级标题"></a>四级标题</h4></li><li><h5 id="五级标题"><a href="#五级标题" class="headerlink" title="五级标题"></a>五级标题</h5></li><li><h6 id="六级标题"><a href="#六级标题" class="headerlink" title="六级标题"></a>六级标题</h6></li></ul><h2 id="字体"><a href="#字体" class="headerlink" title="字体:"></a>字体:</h2><ul><li><strong>加粗</strong></li><li><em>斜体</em></li><li><em><strong>斜体加粗</strong></em></li><li><del>删除线</del></li></ul><h2 id="引用"><a href="#引用" class="headerlink" title="引用:"></a>引用:</h2><blockquote><p>引用</p><blockquote><p>引用</p><blockquote><p>引用</p></blockquote></blockquote></blockquote><h2 id="分割线"><a href="#分割线" class="headerlink" title="分割线:"></a>分割线:</h2><ul><li><h2 id="三个或者以上的-或者"><a href="#三个或者以上的-或者" class="headerlink" title="三个或者以上的-或者*"></a>三个或者以上的-或者*</h2><hr><hr><hr></li></ul><h2 id="图片"><a href="#图片" class="headerlink" title="图片:"></a>图片:</h2><p><img src="/%E5%9B%BE%E7%89%87%E5%9C%B0%E5%9D%80" alt="图片alt" title="图片title"><br>图片alt–&gt;是显示在图片下面的文字，相当于对图片内容的解释<br>图片title–&gt;是图片的标题，当鼠标移到图片上时显示的内容，可不加</p><h2 id="超链接"><a href="#超链接" class="headerlink" title="超链接:"></a>超链接:</h2><p><a href="%E8%B6%85%E9%93%BE%E6%8E%A5%E5%9C%B0%E5%9D%80" title="超链接title">超链接名</a>,title可不加<br><a href="http://baidu.com/">百度</a></p><h2 id="列表"><a href="#列表" class="headerlink" title="列表:"></a>列表:</h2><ul><li><p>无序列表</p><ul><li>列表内容</li></ul><ul><li>列表内容</li></ul><ul><li>列表内容</li></ul></li><li><p>有序列表</p><ol><li>列表内容</li><li>列表内容</li><li>列表内容</li></ol></li><li><p>列表嵌套<br>上一级和下一级之间敲三个空格即可</p></li></ul><h2 id="表格"><a href="#表格" class="headerlink" title="表格:"></a>表格:</h2><table><thead><tr><th>表头</th><th align="center">表头</th><th align="right">表头</th></tr></thead><tbody><tr><td>内容</td><td align="center">内容</td><td align="right">内容</td></tr><tr><td>内容</td><td align="center">内容</td><td align="right">内容</td></tr></tbody></table><h2 id="代码"><a href="#代码" class="headerlink" title="代码:"></a>代码:</h2><ul><li>单行代码<br><code>create database hero;</code></li><li>代码块<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function fun()&#123;</span><br><span class="line">echo &quot;这是一句非常牛逼的代码&quot;;</span><br><span class="line">&#125;</span><br><span class="line">func();</span><br></pre></td></tr></table></figure></li></ul><h2 id="流程图"><a href="#流程图" class="headerlink" title="流程图"></a>流程图</h2><ul><li>示例1<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">st=&gt;start: 开始</span><br><span class="line">op=&gt;operation: My Operation</span><br><span class="line">cond=&gt;condition: Yes or No?</span><br><span class="line">e=&gt;end</span><br><span class="line">st-&gt;op-&gt;cond</span><br><span class="line">cond(yes)-&gt;e</span><br><span class="line">cond(no)-&gt;op</span><br></pre></td></tr></table></figure></li><li>示例2<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">st=&gt;start: 开始</span><br><span class="line">e=&gt;end: 登录</span><br><span class="line">io1=&gt;inputoutput: 输入用户名密码</span><br><span class="line">sub1=&gt;subroutine: 数据库查询子类</span><br><span class="line">cond=&gt;condition: 是否有此用户</span><br><span class="line">cond2=&gt;condition: 密码是否正确</span><br><span class="line">op=&gt;operation: 读入用户信息</span><br><span class="line">st-&gt;io1-&gt;sub1-&gt;cond</span><br><span class="line">cond(yes,right)-&gt;cond2</span><br><span class="line">cond(no)-&gt;io1(right)</span><br><span class="line">cond2(yes,right)-&gt;op-&gt;e</span><br><span class="line">cond2(no)-&gt;io1</span><br></pre></td></tr></table></figure></li></ul><h1 id="上面效果的实现"><a href="#上面效果的实现" class="headerlink" title="上面效果的实现"></a>上面效果的实现</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">## 标题:</span><br><span class="line">- # 一级标题</span><br><span class="line">- ## 二级标题</span><br><span class="line">- ### 三级标题</span><br><span class="line">- #### 四级标题</span><br><span class="line">- ##### 五级标题</span><br><span class="line">- ###### 六级标题</span><br><span class="line"></span><br><span class="line">## 字体:</span><br><span class="line">- **加粗**</span><br><span class="line">- *斜体*</span><br><span class="line">- ***斜体加粗***</span><br><span class="line">- ~~删除线~~</span><br><span class="line"></span><br><span class="line">## 引用:</span><br><span class="line">&gt;引用</span><br><span class="line">&gt;&gt;引用</span><br><span class="line">&gt;&gt;</span><br><span class="line">&gt;&gt;&gt;引用</span><br><span class="line"></span><br><span class="line">## 分割线:</span><br><span class="line">- 三个或者以上的-或者*</span><br><span class="line">   ---</span><br><span class="line">   ----</span><br><span class="line">   ***</span><br><span class="line">   ****</span><br><span class="line"></span><br><span class="line">## 图片:</span><br><span class="line">![图片alt](图片地址 &quot;图片title&quot;)</span><br><span class="line">图片alt--&gt;是显示在图片下面的文字，相当于对图片内容的解释</span><br><span class="line">图片title--&gt;是图片的标题，当鼠标移到图片上时显示的内容，可不加</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 超链接:</span><br><span class="line">[超链接名](超链接地址 &quot;超链接title&quot;),title可不加</span><br><span class="line">[百度](http://baidu.com)</span><br><span class="line"></span><br><span class="line">## 列表:</span><br><span class="line">- 无序列表</span><br><span class="line">   - 列表内容</span><br><span class="line">   + 列表内容</span><br><span class="line">   </span><br><span class="line">   * 列表内容</span><br><span class="line">- 有序列表</span><br><span class="line">   1. 列表内容</span><br><span class="line">   2. 列表内容</span><br><span class="line">   3. 列表内容</span><br><span class="line">- 列表嵌套</span><br><span class="line">上一级和下一级之间敲三个空格即可</span><br><span class="line"></span><br><span class="line">## 表格:</span><br><span class="line">| 表头 | 表头 | 表头 |</span><br><span class="line">| ---- | :----: | ----: |</span><br><span class="line">| 内容 | 内容 | 内容 |</span><br><span class="line">| 内容 | 内容 | 内容 |</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 代码:</span><br><span class="line">- 单行代码</span><br><span class="line">`create database hero;`</span><br><span class="line">- 代码块</span><br><span class="line"></span><br><span class="line">function fun()&#123;</span><br><span class="line">echo &quot;这是一句非常牛逼的代码&quot;;</span><br><span class="line">&#125;</span><br><span class="line">func();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 流程图</span><br><span class="line">- 示例1</span><br><span class="line">flow</span><br><span class="line">st=&gt;start: 开始</span><br><span class="line">op=&gt;operation: My Operation</span><br><span class="line">cond=&gt;condition: Yes or No?</span><br><span class="line">e=&gt;end</span><br><span class="line">st-&gt;op-&gt;cond</span><br><span class="line">cond(yes)-&gt;e</span><br><span class="line">cond(no)-&gt;op</span><br><span class="line"></span><br><span class="line">- 示例2</span><br><span class="line">flow</span><br><span class="line">st=&gt;start: 开始</span><br><span class="line">e=&gt;end: 登录</span><br><span class="line">io1=&gt;inputoutput: 输入用户名密码</span><br><span class="line">sub1=&gt;subroutine: 数据库查询子类</span><br><span class="line">cond=&gt;condition: 是否有此用户</span><br><span class="line">cond2=&gt;condition: 密码是否正确</span><br><span class="line">op=&gt;operation: 读入用户信息</span><br><span class="line">st-&gt;io1-&gt;sub1-&gt;cond</span><br><span class="line">cond(yes,right)-&gt;cond2</span><br><span class="line">cond(no)-&gt;io1(right)</span><br><span class="line">cond2(yes,right)-&gt;op-&gt;e</span><br><span class="line">cond2(no)-&gt;io1</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> markdown </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>github Connection time out</title>
      <link href="/posts/1800485937.html"/>
      <url>/posts/1800485937.html</url>
      
        <content type="html"><![CDATA[<h1 id="异常"><a href="#异常" class="headerlink" title="异常"></a>异常</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在连接github时，执行”ssh -T git@github.com” 命令时，出现</span></span><br><span class="line">ssh: connect to host github.com port 22: Connection timed out</span><br></pre></td></tr></table></figure><h1 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在存放公钥私钥(id_rsa和id_rsa.pub)的文件里，新建config文本</span></span><br><span class="line">vim config</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输入下面内容</span></span><br><span class="line">Host github.com</span><br><span class="line">User 注册github的邮箱</span><br><span class="line">Hostname ssh.github.com</span><br><span class="line">PreferredAuthentications publickey</span><br><span class="line">IdentityFile ~/.ssh/id_rsa</span><br><span class="line">Port 443</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">最后:wq退出编辑即可</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">接着再执行,出现提示回车<span class="built_in">yes</span>即可</span></span><br><span class="line">ssh -T git@github.com</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>elasticsearch+kibana快照实现迁移及恢复</title>
      <link href="/posts/1818393960.html"/>
      <url>/posts/1818393960.html</url>
      
        <content type="html"><![CDATA[<h1 id="1-全部索引存储快照及恢复"><a href="#1-全部索引存储快照及恢复" class="headerlink" title="1. 全部索引存储快照及恢复"></a>1. 全部索引存储快照及恢复</h1><h2 id="1-1-全部索引存储快照"><a href="#1-1-全部索引存储快照" class="headerlink" title="1.1 全部索引存储快照"></a>1.1 全部索引存储快照</h2><h3 id="1-1-2-全部索引注册快照存储库"><a href="#1-1-2-全部索引注册快照存储库" class="headerlink" title="1.1.2 全部索引注册快照存储库"></a>1.1.2 全部索引注册快照存储库</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PUT _snapshot/old_k8s-prod-info</span><br><span class="line">&#123;</span><br><span class="line">&quot;type&quot;: &quot;fs&quot;,</span><br><span class="line">&quot;settings&quot;: &#123;</span><br><span class="line">&quot;location&quot;: &quot;/usr/share/elasticsearch/es-back/snapshot01&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-1-2-快照全部索引"><a href="#1-1-2-快照全部索引" class="headerlink" title="1.1.2 快照全部索引"></a>1.1.2 快照全部索引</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PUT _snapshot/old_k8s-prod-info/backup_all?wait_for_completion=true</span><br></pre></td></tr></table></figure><h3 id="1-1-3-查看快照进度"><a href="#1-1-3-查看快照进度" class="headerlink" title="1.1.3 查看快照进度"></a>1.1.3 查看快照进度</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET _snapshot/old_k8s-prod-info/backup_all/_status</span><br><span class="line">- grep state</span><br><span class="line">- started:正在同步</span><br><span class="line">- success:成功</span><br><span class="line">- failed：失败</span><br></pre></td></tr></table></figure><h2 id="1-2-恢复"><a href="#1-2-恢复" class="headerlink" title="1.2 恢复"></a>1.2 恢复</h2><h3 id="1-2-1-注册快照存储库"><a href="#1-2-1-注册快照存储库" class="headerlink" title="1.2.1 注册快照存储库"></a>1.2.1 注册快照存储库</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PUT _snapshot/old_k8s-prod-info</span><br><span class="line">&#123;</span><br><span class="line">&quot;type&quot;: &quot;fs&quot;,</span><br><span class="line">&quot;settings&quot;: &#123;</span><br><span class="line">&quot;location&quot;: &quot;/usr/share/elasticsearch/es-back/snapshot01&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-2-2-恢复全部索引"><a href="#1-2-2-恢复全部索引" class="headerlink" title="1.2.2 恢复全部索引"></a>1.2.2 恢复全部索引</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST _snapshot/old_k8s-prod-info/backup_all/_restore</span><br></pre></td></tr></table></figure><h3 id="1-2-3-查看快照恢复进度"><a href="#1-2-3-查看快照恢复进度" class="headerlink" title="1.2.3 查看快照恢复进度"></a>1.2.3 查看快照恢复进度</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET _cat/recovery?v</span><br></pre></td></tr></table></figure><h1 id="2-指定索引快照及恢复"><a href="#2-指定索引快照及恢复" class="headerlink" title="2. 指定索引快照及恢复"></a>2. 指定索引快照及恢复</h1><h2 id="2-1-指定索引快照"><a href="#2-1-指定索引快照" class="headerlink" title="2.1  指定索引快照"></a>2.1  指定索引快照</h2><h3 id="2-1-1-指定索引注册快照存储库"><a href="#2-1-1-指定索引注册快照存储库" class="headerlink" title="2.1.1 指定索引注册快照存储库"></a>2.1.1 指定索引注册快照存储库</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PUT _snapshot/old_k8s-prod-info</span><br><span class="line">&#123;</span><br><span class="line">&quot;type&quot;: &quot;fs&quot;,</span><br><span class="line">&quot;settings&quot;: &#123;</span><br><span class="line">&quot;location&quot;: &quot;/usr/share/elasticsearch/es-back/snapshot1119&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-1-2-指定索引存储快照"><a href="#2-1-2-指定索引存储快照" class="headerlink" title="2.1.2 指定索引存储快照"></a>2.1.2 指定索引存储快照</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PUT _snapshot/old_k8s-prod-info/k8s-prod-info-2023.11.19?wait_for_completion=true</span><br><span class="line">&#123;</span><br><span class="line">&quot;indices&quot;: &quot;k8s-prod-info-2023.11.19&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-1-3-查看指定索引快照进度"><a href="#2-1-3-查看指定索引快照进度" class="headerlink" title="2.1.3 查看指定索引快照进度"></a>2.1.3 查看指定索引快照进度</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET _snapshot/old_k8s-prod-info/k8s-prod-info-2023.11.19/_status</span><br></pre></td></tr></table></figure><h2 id="2-2-恢复"><a href="#2-2-恢复" class="headerlink" title="2.2 恢复"></a>2.2 恢复</h2><h3 id="2-2-1-指定索引注册快照存储库"><a href="#2-2-1-指定索引注册快照存储库" class="headerlink" title="2.2.1 指定索引注册快照存储库"></a>2.2.1 指定索引注册快照存储库</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PUT _snapshot/old_k8s-prod-info</span><br><span class="line">&#123;</span><br><span class="line">&quot;type&quot;: &quot;fs&quot;,</span><br><span class="line">&quot;settings&quot;: &#123;</span><br><span class="line">&quot;location&quot;: &quot;/usr/share/elasticsearch/es-back/snapshot1119&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2-2-恢复指定索引"><a href="#2-2-2-恢复指定索引" class="headerlink" title="2.2.2 恢复指定索引"></a>2.2.2 恢复指定索引</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">POST _snapshot/old_k8s-prod-info/k8s-prod-info-2023.11.19/_restore</span><br><span class="line">&#123;</span><br><span class="line">&quot;indices&quot;: &quot;k8s-prod-info-2023.11.19&quot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">替换索引名称恢复</span></span><br><span class="line">POST _snapshot/old_k8s-prod-info/k8s-prod-info-2023.11.19/_restore</span><br><span class="line">&#123;</span><br><span class="line">  &quot;indices&quot;: &quot;k8s-prod-info-2023.11.19&quot;,</span><br><span class="line">  &quot;rename_pattern&quot;: &quot;k8s-prod-info-2023.11.19&quot;,</span><br><span class="line">  &quot;rename_replacement&quot;: &quot;k8s-prod-info-2023.11.19-old&quot;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h3 id="2-2-3-查看快照恢复进度"><a href="#2-2-3-查看快照恢复进度" class="headerlink" title="2.2.3 查看快照恢复进度"></a>2.2.3 查看快照恢复进度</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET _cat/recovery?v</span><br><span class="line">- 显示100%完成</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
          <category> efk </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ElasticSearch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mysql 删除重复数据</title>
      <link href="/posts/3265730413.html"/>
      <url>/posts/3265730413.html</url>
      
        <content type="html"><![CDATA[<h1 id="Mysql如何删除重复数据"><a href="#Mysql如何删除重复数据" class="headerlink" title="Mysql如何删除重复数据"></a>Mysql如何删除重复数据</h1><h2 id="项目背景："><a href="#项目背景：" class="headerlink" title="项目背景："></a>项目背景：</h2><p>在RocketMQ的消费者服务中，发现了重复消费的情况，为了处理，需先将消费者停止消费，去重消息ID重复的数据，再给消息ID设置唯一索引。</p><h3 id="方法一：使用临时表"><a href="#方法一：使用临时表" class="headerlink" title="方法一：使用临时表"></a><strong>方法一：使用临时表</strong></h3><ul><li>创建一个临时表，用于存储要保留的数据。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> consumer_crm_record_tmp <span class="keyword">LIKE</span> consumer_crm_record;</span><br></pre></td></tr></table></figure><ul><li>将要保留的数据存储到临时表中</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> consumer_crm_record_tmp</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MAX</span>(id) <span class="keyword">AS</span> id,message_id,message,response</span><br><span class="line"><span class="keyword">FROM</span> consumer_crm_record</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> message_id;</span><br></pre></td></tr></table></figure><ul><li>删除原表中的数据</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span>  consumer_crm_record</span><br></pre></td></tr></table></figure><ul><li>将临时表中的数据加入到原表中</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> consumer_crm_record</span><br><span class="line"><span class="keyword">SELECT</span>  id,message_id,message,response</span><br><span class="line"><span class="keyword">FROM</span> consumer_crm_record_tmp;</span><br></pre></td></tr></table></figure><ul><li>删除临时表</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> consumer_crm_record_tmp;</span><br></pre></td></tr></table></figure><p>创建临时表的优点：</p><ul><li>简单直观：通过创建临时表，您可以明确地将要删除的数据和要保留的数据分开存储，易于理解和管理。</li><li>可读性好：临时表的使用可以使查询语句更易读，特别是对于复杂的逻辑操作。</li><li>可以灵活处理：临时表可以在多个查询之间使用，可以执行额外的操作，例如插入、更新或查询临时表的数据。</li></ul><p>创建临时表的缺点：</p><ul><li>需要额外的存储空间：创建临时表需要占用额外的存储空间，特别是在处理大量数据时可能会对磁盘空间造成一定的压力。</li><li>需要额外的操作及权限：创建、插入和删除临时表需要执行额外的数据库操作，增加了一定的复杂性。</li></ul><h3 id="方法二：使用left-join-删除（强烈推荐）"><a href="#方法二：使用left-join-删除（强烈推荐）" class="headerlink" title="方法二：使用left join 删除（强烈推荐）"></a><strong>方法二：使用left join 删除（强烈推荐）</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> t1 </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">        consumer_crm_record t1</span><br><span class="line">        <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> ( <span class="keyword">SELECT</span> <span class="built_in">MAX</span>( id ) <span class="keyword">AS</span> max_id, message_id <span class="keyword">FROM</span> consumer_crm_record <span class="keyword">GROUP</span> <span class="keyword">BY</span> message_id ) t2 <span class="keyword">ON</span> t1.message_id <span class="operator">=</span> t2.message_id </span><br><span class="line">        <span class="keyword">AND</span> t1.id <span class="operator">=</span> t2.max_id </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">        t2.max_id <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure><p>这个查询将根据message_id进行分组，并保留每个组中的最大id。然后，它使用左连接将原始表与这些最大id进行比较。如果连接失败（即max_id为NULL），则表示该行不是具有最大id的行，因此将被删除。</p><p>LEFT JOIN的优点：</p><ul><li>可以利用索引：LEFT JOIN 可以利用索引来加速查询，特别是在连接字段上存在索引的情况下。</li><li>更高的灵活性：LEFT JOIN 可以与其他表达式和条件组合使用，使得查询可以更加灵活。</li></ul><p>LEFT JOIN的缺点：</p><ul><li>性能可能受限：当处理大量数据时，LEFT JOIN 可能会导致较慢的查询速度，尤其是在连接字段没有索引或使用了复杂的连接条件时。</li><li>查询复杂度高：使用 LEFT JOIN 进行连接查询时，需要编写较为复杂的查询语句，对于新手而言可能会比较困难。</li></ul><h3 id="方法三：使用not-in-删除"><a href="#方法三：使用not-in-删除" class="headerlink" title="方法三：使用not in 删除"></a><strong>方法三：使用not in 删除</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line"> consumer_crm_record t1 </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line"> id <span class="keyword">NOT</span> <span class="keyword">IN</span> ( <span class="keyword">SELECT</span> max_id <span class="keyword">FROM</span> ( <span class="keyword">SELECT</span> <span class="built_in">MAX</span>( id ) <span class="keyword">AS</span> max_id <span class="keyword">FROM</span> consumer_crm_record <span class="keyword">GROUP</span> <span class="keyword">BY</span> message_id) tmp );</span><br></pre></td></tr></table></figure><p>NOT IN的优点：</p><ul><li>简单易用：NOT IN 是一种直观简单的方式来筛选出不在指定列表中的数据。</li><li>可读性好：NOT IN 子句的语义明确，易于理解和维护。</li></ul><p>NOT IN的缺点：</p><ul><li>性能可能较低：NOT IN 子查询对于大型数据集可能会导致较慢的查询速度，尤其是在子查询中返回大量结果时。</li><li>NULL 值处理：NOT IN 子句在处理 NULL 值时需要特别注意，因为 NULL 的处理可能会导致意外的结果。</li></ul><h3 id="方法四：使用窗口函数（MySQL-8-0以上支持）"><a href="#方法四：使用窗口函数（MySQL-8-0以上支持）" class="headerlink" title="方法四：使用窗口函数（MySQL 8.0以上支持）"></a><strong>方法四：使用窗口函数（MySQL 8.0以上支持）</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span></span><br><span class="line"><span class="keyword">FROM</span> consumer_crm_record</span><br><span class="line"><span class="keyword">WHERE</span> id <span class="keyword">in</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> id</span><br><span class="line">    <span class="keyword">FROM</span>(</span><br><span class="line">        <span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">        <span class="keyword">FROM</span> (</span><br><span class="line">            <span class="keyword">SELECT</span> <span class="built_in">ROW_NUMBER</span>() <span class="keyword">OVER</span> w <span class="keyword">AS</span> row_num,id</span><br><span class="line">            <span class="keyword">FROM</span> consumer_crm_record  <span class="keyword">where</span> message_id <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">            <span class="keyword">WINDOW</span> w <span class="keyword">AS</span> (<span class="keyword">PARTITION</span> <span class="keyword">BY</span> message_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> id)</span><br><span class="line">        )t</span><br><span class="line">        <span class="keyword">WHERE</span> row_num <span class="operator">&gt;</span><span class="number">1</span></span><br><span class="line">    )e</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>窗口函数的优点：</p><ul><li>简化查询逻辑：使用窗口函数可以在单个查询中完成去重操作，而不需要使用其他复杂的子查询或连接操作。这简化了查询逻辑，使查询更易读和维护。</li><li>高效性能：窗口函数在处理大型数据集时通常比传统的子查询或连接操作更高效。窗口函数可以在单个扫描中计算结果，而不需要多次访问数据表。</li><li>保留原始数据：使用窗口函数进行去重操作时，您可以保留原始数据表中的所有列，并在结果中添加去重的标识。这使得您可以查看去重结果与原始数据之间的关系，并进行进一步的分析和处理。</li></ul><p>窗口函数的缺点：</p><ul><li>学习曲线：窗口函数是一种高级的SQL功能，相对于传统的查询语法来说，使用窗口函数可能需要一些学习和理解。如果您对窗口函数不熟悉，可能需要花费一些时间来学习和了解其语法和用法。</li><li>版本兼容性：窗口函数在MySQL中的支持是在版本8.0之后引入的。如果您使用的是较旧的MySQL版本，那么窗口函数可能不可用，您将无法使用窗口函数进行去重操作。</li><li>内存消耗：窗口函数可能需要在内存中保存一些额外的中间结果，尤其是在处理大型数据集时。这可能会导致一些额外的内存消耗。因此，在使用窗口函数进行去重操作时，需要注意内存使用情况，并确保系统具有足够的内存资源。</li></ul><h3 id="创建唯一索引"><a href="#创建唯一索引" class="headerlink" title="创建唯一索引"></a><strong>创建唯一索引</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> INDEX idx_message_id <span class="keyword">on</span> consumer_crm_record(message_id);</span><br></pre></td></tr></table></figure><h3 id="在百万级表中执行中发现报错：1206-the-total-number-of-locks-exceeds-the-lock-table-size"><a href="#在百万级表中执行中发现报错：1206-the-total-number-of-locks-exceeds-the-lock-table-size" class="headerlink" title="在百万级表中执行中发现报错：1206- the total number of locks exceeds the lock table size"></a><strong>在百万级表中执行中发现报错：1206- the total number of locks exceeds the lock table size</strong></h3><p>innodb_buffer_pool    mysql缓冲池太小  默认为16M</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span>  variables  <span class="keyword">like</span> <span class="string">&#x27;%innodb_buffer_pool_size%&#x27;</span></span><br></pre></td></tr></table></figure><p>修改缓冲池大小为2G</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> innodb_buffer_pool_size<span class="operator">=</span><span class="number">2147483648</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux常用操作及示例</title>
      <link href="/posts/201088553.html"/>
      <url>/posts/201088553.html</url>
      
        <content type="html"><![CDATA[<h1 id="Linux常用操作及示例"><a href="#Linux常用操作及示例" class="headerlink" title="Linux常用操作及示例"></a>Linux常用操作及示例</h1><p>记录一些常用的linux操作以备学习</p><h2 id="终端操作"><a href="#终端操作" class="headerlink" title="终端操作"></a>终端操作</h2><h3 id="文件和目录管理"><a href="#文件和目录管理" class="headerlink" title="文件和目录管理"></a>文件和目录管理</h3><ul><li><p><code>ls</code>：列出当前目录下的文件和文件夹。<br>示例：<code>ls -l</code>命令用于以详细列表形式显示文件和目录。</p></li><li><p><code>cd</code>：切换到指定目录。<br>示例：<code>cd /home</code>命令用于切换到&#x2F;home目录。</p></li><li><p><code>pwd</code>：显示当前所在目录的路径。<br>示例：<code>pwd</code>命令用于显示当前所在的目录路径。</p></li><li><p><code>mkdir</code>：创建新目录。<br>示例：<code>mkdir myfolder</code>命令用于在当前目录下创建名为myfolder的新目录。</p></li><li><p><code>rm</code>：删除文件或目录。<br>示例：<code>rm myfile.txt</code>命令用于删除名为myfile.txt的文件。</p></li><li><p><code>cp</code>：复制文件或目录。<br>示例：<code>cp myfile.txt myfolder/</code>命令用于将myfile.txt文件复制到myfolder目录。</p></li><li><p><code>mv</code>：移动文件或目录。<br>示例：<code>mv myfile.txt myfolder/</code>命令用于将myfile.txt文件移动到myfolder目录。</p></li></ul><h3 id="文件查看和编辑"><a href="#文件查看和编辑" class="headerlink" title="文件查看和编辑"></a>文件查看和编辑</h3><ul><li><p><code>cat</code>：显示文件内容。<br>示例：<code>cat myfile.txt</code>命令用于显示myfile.txt文件的内容。</p></li><li><p><code>less</code>：分页显示文件内容。<br>示例：<code>less myfile.txt</code>命令用于以分页方式显示myfile.txt文件的内容。</p></li><li><p><code>head</code>：显示文件的前几行。<br>示例：<code>head -n 5 myfile.txt</code>命令用于显示myfile.txt文件的前5行。</p></li><li><p><code>tail</code>：显示文件的后几行。<br>示例：<code>tail -n 10 myfile.txt</code>命令用于显示myfile.txt文件的最后10行。</p></li><li><p><code>nano</code>：使用Nano编辑器编辑文件。<br>示例：<code>nano myfile.txt</code>命令用于使用Nano编辑器打开myfile.txt文件进行编辑。</p></li><li><p><code>vi</code>或<code>vim</code>：使用Vim编辑器编辑文件。<br>示例：<code>vi myfile.txt</code>命令用于使用Vim编辑器打开myfile.txt文件进行编辑。</p></li></ul><h3 id="系统信息查看"><a href="#系统信息查看" class="headerlink" title="系统信息查看"></a>系统信息查看</h3><ul><li><p><code>uname</code>：显示系统信息。<br>示例：<code>uname -a</code>命令用于显示完整的系统信息。</p></li><li><p><code>whoami</code>：显示当前登录用户。<br>示例：<code>whoami</code>命令用于显示当前登录用户的用户名。</p></li><li><p><code>top</code>：显示系统当前运行的进程和资源占用情况。<br>示例：<code>top</code>命令用于实时显示系统的运行情况。</p></li><li><p><code>free</code>：显示系统内存使用情况。<br>示例：<code>free -h</code>命令用于以人类可读的方式显示系统的内存使用情况。</p></li><li><p><code>df</code>：显示磁盘空间使用情况。<br>示例：<code>df -h</code>命令用于以人类可读的方式显示磁盘空间的使用情况。</p></li></ul><h2 id="包管理器"><a href="#包管理器" class="headerlink" title="包管理器"></a>包管理器</h2><h3 id="APT"><a href="#APT" class="headerlink" title="APT"></a>APT</h3><ul><li><p><code>apt update</code>：更新软件包列表。<br>示例：<code>apt update</code>命令用于更新可用软件包的列表。</p></li><li><p><code>apt upgrade</code>：升级已安装的软件包。<br>示例：<code>apt upgrade</code>命令用于升级所有已安装的软件包。</p></li><li><p><code>apt install</code>：安装指定的软件包。<br>示例：<code>apt install nginx</code>命令用于安装Nginx Web服务器。</p></li><li><p><code>apt remove</code>：卸载指定的软件包。<br>示例：<code>apt remove nginx</code>命令用于卸载Nginx Web服务器。</p></li><li><p><code>apt search</code>：搜索可用的软件包。<br>示例：<code>apt search python</code>命令用于搜索与关键词”python”相关的可用软件包。</p></li></ul><h3 id="YUM"><a href="#YUM" class="headerlink" title="YUM"></a>YUM</h3><ul><li><p><code>yum update</code>：更新软件包。<br>示例：<code>yum update</code>命令用于更新所有可用的软件包。</p></li><li><p><code>yum upgrade</code>：升级已安装的软件包。<br>示例：<code>yum upgrade</code>命令用于升级所有已安装的软件包。</p></li><li><p><code>yum install</code>：安装指定的软件包。<br>示例：<code>yum install httpd</code>命令用于安装Apache HTTP服务器。</p></li><li><p><code>yum remove</code>：卸载指定的软件包。<br>示例：<code>yum remove httpd</code>命令用于卸载Apache HTTP服务器。</p></li><li><p><code>yum search</code>：搜索可用的软件包。<br>示例：<code>yum search mysql</code>命令用于搜索与关键词”mysql”相关的可用软件包。</p></li></ul><h2 id="用户和权限管理"><a href="#用户和权限管理" class="headerlink" title="用户和权限管理"></a>用户和权限管理</h2><ul><li><p><code>useradd</code>：创建新用户。<br>示例：<code>useradd john</code>命令用于创建名为”john”的新用户。</p></li><li><p><code>passwd</code>：修改用户密码。<br>示例：<code>passwd john</code>命令用于修改用户”john”的密码。</p></li><li><p><code>usermod</code>：修改用户属性。<br>示例：<code>usermod -aG sudo john</code>命令用于将用户”john”添加到sudo用户组。</p></li><li><p><code>userdel</code>：删除用户。<br>示例：<code>userdel john</code>命令用于删除用户”john”。</p></li><li><p><code>sudo</code>：以超级用户权限执行命令。<br>示例：<code>sudo apt update</code>命令用于以超级用户权限更新软件包列表。</p></li><li><p><code>chmod</code>：修改文件或目录的权限。<br>示例：<code>chmod 644 myfile.txt</code>命令用于将myfile.txt文件的权限设置为644。</p></li><li><p><code>chown</code>：修改文件或目录的所有者。<br>示例：<code>chown john myfile.txt</code>命令用于将myfile.txt文件的所有者设置为用户”john”。</p></li><li><p><code>chgrp</code>：修改文件或目录的所属组。<br>示例：<code>chgrp staff myfile.txt</code>命令用于将myfile.txt文件的所属组设置为”staff”。</p></li></ul><h2 id="网络管理"><a href="#网络管理" class="headerlink" title="网络管理"></a>网络管理</h2><ul><li><p><code>ifconfig</code>：显示和配置网络接口。<br>示例：<code>ifconfig eth0</code>命令用于显示名为”eth0”的网络接口信息。</p></li><li><p><code>ping</code>：测试与另一个主机的连接。<br>示例：<code>ping google.com</code>命令用于测试与google.com主机的连接。</p></li><li><p><code>ssh</code>：通过SSH协议远程登录到另一个主机。<br>示例：<code>ssh user@example.com</code>命令用于通过SSH协议远程登录到example.com主机。</p></li><li><p><code>scp</code>：通过SSH协议在本地主机和远程主机之间复制文件。<br>示例：<code>scp myfile.txt user@example.com:/home/user/</code>命令用于将myfile.txt文件复制到example.com主机的&#x2F;home&#x2F;user&#x2F;目录。</p></li><li><p><code>wget</code>：从网络上下载文件。<br>示例：<code>wget https://example.com/file.zip</code>命令用于从example.com下载file.zip文件。</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> 操作系统 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
